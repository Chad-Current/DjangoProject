{% extends 'dashboard/dashboard.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<div class="form-container">
<div class="form-wrapper">

  {% if form.non_field_errors %}
  <ul class="errorlist nonfield" role="alert">
    {% for error in form.non_field_errors %}<li>{{ error }}</li>{% endfor %}
  </ul>
  {% endif %}

  <form method="post" novalidate>
    {% csrf_token %}

    <!-- ══════════════════════════════════════════
         DEVICE ASSIGNMENT
    ══════════════════════════════════════════ -->
    <fieldset class="form-fieldset">
      <legend class="form-fieldset-legend">Device Assignment</legend>

      <div class="alert alert-warning">
        <strong>Required:</strong> You must assign this device to a contact.
      </div>

      <div class="form-field{% if form.delegated_device_to.errors %} has-error{% endif %}">
        <label for="{{ form.delegated_device_to.id_for_label }}"
          class="ob-label-tooltip"
          title="The trusted contact who should take responsibility for this device — wiping, transferring data, or following your decommission instructions.">
          Assign Device To <span class="req" aria-hidden="true">*</span>
          <span class="ob-tip" role="tooltip">The trusted contact who should take responsibility for this device — wiping, transferring data, or following your decommission instructions.</span>
        </label>
        {{ form.delegated_device_to }}
        {% if form.delegated_device_to.errors %}
          <div class="error" role="alert">{{ form.delegated_device_to.errors }}</div>
        {% endif %}
      </div>

    </fieldset>

    <!-- ══════════════════════════════════════════
         DEVICE INFORMATION
    ══════════════════════════════════════════ -->
    <fieldset class="form-fieldset">
      <legend class="form-fieldset-legend">Device Information</legend>

      <div class="form-field{% if form.device_type.errors %} has-error{% endif %}">
        <label for="{{ form.device_type.id_for_label }}"
          class="ob-label-tooltip"
          title="General category — Phone, Laptop, Desktop, Tablet, Smart Watch, or Other. Used to group devices for your family.">
          Type of Device <span class="req" aria-hidden="true">*</span>
          <span class="ob-tip" role="tooltip">General category — Phone, Laptop, Desktop, Tablet, Smart Watch, or Other. Used to group devices for your family.</span>
        </label>
        {{ form.device_type }}
        {% if form.device_type.errors %}
          <div class="error" role="alert">{{ form.device_type.errors }}</div>
        {% endif %}
      </div>

      <div class="form-field{% if form.device_name.errors %} has-error{% endif %}">
        <label for="{{ form.device_name.id_for_label }}"
          class="ob-label-tooltip"
          title="Brand, model, and year — specific enough for your family to identify it. e.g. iPhone 15 Pro, MacBook Pro 2022.">
          Name <span class="req" aria-hidden="true">*</span>
          <span class="ob-tip" role="tooltip">Brand, model, and year — specific enough for your family to identify it. e.g. iPhone 15 Pro, MacBook Pro 2022.</span>
        </label>
        {{ form.device_name }}
        {% if form.device_name.errors %}
          <div class="error" role="alert">{{ form.device_name.errors }}</div>
        {% endif %}
      </div>

      <div class="form-field{% if form.owner_label.errors %} has-error{% endif %}">
        <label for="{{ form.owner_label.id_for_label }}"
          class="ob-label-tooltip"
          title="A short nickname your family will recognise — e.g. 'Mom's iPhone' or 'Work Laptop'. Shown as a badge on the device list.">
          Labeled as
          <span class="ob-tip" role="tooltip">A short nickname your family will recognise — e.g. "Mom's iPhone" or "Work Laptop". Shown as a badge on the device list.</span>
        </label>
        {{ form.owner_label }}
        {% if form.owner_label.errors %}
          <div class="error" role="alert">{{ form.owner_label.errors }}</div>
        {% endif %}
      </div>

      <div class="form-field{% if form.location_description.errors %} has-error{% endif %}">
        <label for="{{ form.location_description.id_for_label }}"
          class="ob-label-tooltip"
          title="Where this device is physically stored. Be specific — e.g. 'Bedroom nightstand drawer' or 'Home office desk'.">
          Typical Location of Device
          <span class="ob-tip" role="tooltip">Where this device is physically stored. Be specific — e.g. "Bedroom nightstand drawer" or "Home office desk".</span>
        </label>
        {{ form.location_description }}
        {% if form.location_description.errors %}
          <div class="error" role="alert">{{ form.location_description.errors }}</div>
        {% endif %}
      </div>

    </fieldset>

    <!-- ══════════════════════════════════════════
         SECURITY INFORMATION
    ══════════════════════════════════════════ -->
    <fieldset class="form-fieldset">
      <legend class="form-fieldset-legend">Security Information</legend>

      <div class="form-field{% if form.unlock_method_description.errors %} has-error{% endif %}">
        <label for="{{ form.unlock_method_description.id_for_label }}"
          class="ob-label-tooltip"
          title="Describe access without recording the actual PIN or password. Point your family to where credentials are stored — e.g. '6-digit PIN stored in 1Password'.">
          Unlock Method
          <span class="ob-tip" role="tooltip">Describe access without recording the actual PIN or password. Point your family to where credentials are stored — e.g. "6-digit PIN stored in 1Password".</span>
        </label>
        {{ form.unlock_method_description }}
        {% if form.unlock_method_description.errors %}
          <div class="error" role="alert">{{ form.unlock_method_description.errors }}</div>
        {% endif %}
      </div>

      <div class="form-field{% if form.decommission_instruction.errors %} has-error{% endif %}">
        <label for="{{ form.decommission_instruction.id_for_label }}"
          class="ob-label-tooltip"
          title="Tell your family exactly what to do — wipe and give away, donate, recycle, keep, or sell. Be specific so there's no guesswork.">
          Decommission Instructions
          <span class="ob-tip" role="tooltip">Tell your family exactly what to do — wipe and give away, donate, recycle, keep, or sell. Be specific so there's no guesswork.</span>
        </label>
        {{ form.decommission_instruction }}
        {% if form.decommission_instruction.errors %}
          <div class="error" role="alert">{{ form.decommission_instruction.errors }}</div>
        {% endif %}
      </div>

      <div class="form-field{% if form.used_for_2fa.errors %} has-error{% endif %}">
        <label class="ob-check-row ob-label-tooltip"
          title="Check this if the device receives login verification codes (SMS or authenticator app). Critical for your family to know before wiping the device.">
          {{ form.used_for_2fa }}
          <span class="ob-check-label">Used For Two Factor Authentication</span>
          <span class="ob-tip" role="tooltip">Check this if the device receives login verification codes (SMS or authenticator app). Critical for your family to know before wiping the device.</span>
        </label>
        {% if form.used_for_2fa.errors %}
          <div class="error" role="alert">{{ form.used_for_2fa.errors }}</div>
        {% endif %}
      </div>

    </fieldset>

    <!-- ══════════════════════════════════════════
         REVIEW REQUIREMENTS
    ══════════════════════════════════════════ -->
    <fieldset class="form-fieldset">
      <legend class="form-fieldset-legend">Review Requirements</legend>

      <div class="form-field{% if form.review_time.errors %} has-error{% endif %}">
        <label for="{{ form.review_time.id_for_label }}"
          class="ob-label-tooltip"
          title="How often you want a reminder to verify this device's details — location, unlock method, and instructions — are still accurate.">
          Review needed in
          <span class="ob-tip" role="tooltip">How often you want a reminder to verify this device's details — location, unlock method, and instructions — are still accurate.</span>
        </label>
        {{ form.review_time }}
        {% if form.review_time.errors %}
          <div class="error" role="alert">{{ form.review_time.errors }}</div>
        {% endif %}
      </div>

    </fieldset>

    <!-- ── ACTIONS ─────────────────────────────── -->
    <div class="button-group">
      <button type="submit" class="btn btn-primary">Save Device</button>
      <button type="button" class="btn btn-secondary" onclick="history.back();">Back</button>
    </div>

  </form>
</div>
</div>
{% endblock %}