{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="{% static 'baseapp/css/stylesheet.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'baseapp/css/index.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'baseapp/css/forms.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'dashboard/css/listing.css' %}" type="text/css">
    <link
        href="https://fonts.googleapis.com/css2?family=Courgette&family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap"
        rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>

<body>

    {% include "baseapp/navbar.html" %}
    {% include "dashboard/navblocks.html" %}

    <div class="main">
    {% block content %}
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                {% if has_documents %}
                {# Contact has documents - show warning #}
                <div class="card border-danger">
                    <div class="card-header bg-danger text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-exclamation-triangle"></i>
                            Cannot Delete
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-danger">
                            <h5>{{ total_documents }} document(s) have been assigned to <strong>{{ contact.contact_name }}</strong></h5>
                            <p class="mb-0">
                                You cannot delete this because they have documents assigned to them.
                                Please reassign these documents to another contact first.
                            </p>
                        </div>

                        <h5 class="mt-4">Assigned Documents:</h5>

                        {% if estate_documents %}
                        <div class="mb-3">
                            <h6 class="text-muted">Estate Documents ({{ estate_documents.count }})</h6>
                            <ul class="list-group">
                                {% for doc in estate_documents %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span>
                                        <i class="fas fa-file-contract text-primary"></i>
                                        {{ doc.name_or_title }}
                                    </span>
                                    <a href="{% url 'dashboard:estate_update' doc.pk %}"
                                        class="btn btn-sm btn-outline-primary">
                                        Reassign
                                    </a>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        {% if important_documents %}
                        <div class="mb-3">
                            <h6 class="text-muted">Important Documents ({{ important_documents.count }})</h6>
                            <ul class="list-group">
                                {% for doc in important_documents %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span>
                                        <i class="fas fa-file-alt text-info"></i>
                                        {{ doc.name_or_title }}
                                    </span>
                                    <a href="{% url 'dashboard:importantdocument_update' doc.pk %}"
                                        class="btn btn-sm btn-outline-primary">
                                        Reassign
                                    </a>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        {% if has_other_contacts %}
                        <div class="alert alert-info mt-4">
                            <h6><i class="fas fa-info-circle"></i> Quick Reassignment Options</h6>
                            <p class="mb-2">You can reassign documents to these contacts:</p>
                            <ul class="mb-0">
                                {% for other_contact in other_contacts %}
                                <li>{{ other_contact.contact_name }} ({{ other_contact.contact_relation }})</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% else %}
                        <div class="alert alert-warning mt-4">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>No other contacts available.</strong>
                            You'll need to create another contact before you can reassign these documents.
                        </div>
                        {% endif %}

                        <div class="mt-4">
                            <a href="{% url 'dashboard:contact_list' %}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Back to Contact List
                            </a>
                            {% if not has_other_contacts %}
                            <a href="{% url 'dashboard:contact_create' %}" class="btn btn-primary">
                                <i class="fas fa-user-plus"></i> Create New Contact
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>

                {% else %}
                {# Contact has no documents - show normal delete confirmation #}
                <div class="card border-warning">
                    <div class="card-header bg-warning">
                        <h4 class="mb-0">
                            <i class="fas fa-exclamation-triangle"></i>
                            Confirm Deletion
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-warning">
                            <h5>Are you sure you want to delete this contact?</h5>
                            <p class="mb-0">
                                <strong>{{ contact.contact_name }}</strong> ({{ contact.contact_relation }})
                            </p>
                        </div>

                        <div class="contact-details mb-4">
                            <h6>Contact Information:</h6>
                            <ul class="list-unstyled">
                                {% if contact.email %}
                                <li><i class="fas fa-envelope"></i> {{ contact.email }}</li>
                                {% endif %}
                                {% if contact.phone %}
                                <li><i class="fas fa-phone"></i> {{ contact.phone }}</li>
                                {% endif %}
                                {% if contact.is_emergency_contact %}
                                <li><span class="badge bg-danger">Emergency Contact</span></li>
                                {% endif %}
                                {% if contact.is_digital_executor %}
                                <li><span class="badge bg-primary">Digital Executor</span></li>
                                {% endif %}
                            </ul>
                        </div>

                        <div class="alert alert-info">
                            <i class="fas fa-check-circle"></i>
                            This contact has no documents assigned and can be safely deleted.
                        </div>

                        <form method="post">
                            {% csrf_token %}
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-danger">
                                    <i class="fas fa-trash"></i> Yes, Delete Contact
                                </button>
                                <a href="{% url 'dashboard:contact_detail' contact.pk %}" class="btn btn-secondary">
                                    <i class="fas fa-times"></i> Cancel
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endblock %}
</div>

    {% include "baseapp/footer.html" %}
    <script src="https://kit.fontawesome.com/ea6a27c21b.js" crossorigin="anonymous"></script>

</body>

</html>