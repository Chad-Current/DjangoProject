{% extends "dashboard/dashboard.html" %}
{% load static %}

{% block title %}Delete Funeral Plan{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'dashboard/css/onboard.css' %}">
<link rel="stylesheet" href="{% static 'dashboard/css/delete.css' %}">
{% endblock %}

{% block content %}
<div class="delete-view-wrapper">
  <div class="delete-view">

    <!-- Warning icon -->
    <div class="delete-icon">⚠️</div>

    <h1 class="delete-title">Delete Funeral Plan</h1>
    <p class="delete-subtitle">
      This will permanently erase your entire funeral plan.<br>
      Your other estate data will not be affected.
    </p>

    <!-- Sections that will be erased -->
    <div class="delete-item-name" style="flex-wrap:wrap; gap:.4rem; margin: 1.25rem 0 1.75rem; justify-content: center;">
      <i class="fas fa-folder-open"></i>
      {% if progress.personal_info %}<span class="ob-badge badge-blue">Personal Info</span>{% endif %}
      {% if progress.service %}<span class="ob-badge badge-blue">Service Prefs</span>{% endif %}
      {% if progress.disposition %}<span class="ob-badge badge-blue">Disposition</span>{% endif %}
      {% if progress.ceremony %}<span class="ob-badge badge-blue">Ceremony</span>{% endif %}
      {% if progress.reception %}<span class="ob-badge badge-blue">Reception</span>{% endif %}
      {% if progress.obituary %}<span class="ob-badge badge-blue">Obituary</span>{% endif %}
      {% if progress.admin %}<span class="ob-badge badge-blue">Admin</span>{% endif %}
      {% if progress.instructions %}<span class="ob-badge badge-blue">Instructions</span>{% endif %}
      {% if not progress.personal_info and not progress.service and not progress.disposition and not progress.ceremony and not progress.reception and not progress.obituary and not progress.admin and not progress.instructions %}
        <span style="font-family: var(--main-font); font-size: var(--font-sm); color: #9ca3af;">No sections completed yet</span>
      {% endif %}
    </div>

    <!-- Warning notice -->
    <div class="delete-warning-notice">
      <i class="fas fa-triangle-exclamation"></i>
      <p>
        <strong>This cannot be undone.</strong> Once deleted, all funeral plan data is permanently
        removed and cannot be recovered. You will be able to start a new plan at any time.
      </p>
    </div>

    <!-- Single form wrapping BOTH the input and the submit button -->
    <form method="post" id="deleteForm" style="width: 100%;">
      {% csrf_token %}

      <!-- Confirmation input -->
      <div style="margin-bottom: 1.5rem; text-align: left;">
        <label for="confirm_text"
               style="display:block; font-family:var(--main-font); font-size:var(--font-sm);
                      font-weight:700; color:var(--ten-percent); margin-bottom:.4rem;">
          Type
          <code style="background:#f3f4f6; border:1px solid #e5e7eb; border-radius:4px;
                       padding:.1rem .4rem; color:#dc2626; font-weight:700; letter-spacing:.05em;">DELETE</code>
          to confirm
        </label>
        <input
          type="text"
          id="confirm_text"
          name="confirm_text"
          placeholder="Type DELETE to confirm"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
          style="width:100%; padding:9px 13px; border:1.5px solid #dce6f0; border-radius:10px;
                 font-family:var(--main-font); font-size:var(--font-nm); color:var(--text-color-dark);
                 background:var(--background-color); outline:none; box-sizing:border-box;
                 transition:border-color .2s, box-shadow .2s;"
          oninput="document.getElementById('delete-btn').disabled = this.value.trim() !== 'DELETE';"
        >
        <p style="font-family:var(--paragraph-font); font-size:var(--font-sm); font-weight:300;
                  color:var(--thirty-percent); margin:.3rem 0 0;">
          Must be typed exactly — all capital letters.
        </p>
      </div>

      <!-- Action buttons -->
      <div class="delete-actions">
        <button type="submit" id="delete-btn" class="btn-confirm-delete" disabled>
          <i class="fas fa-trash"></i> Permanently Delete Plan
        </button>
        <a href="{% url 'dashboard:funeralplan_index' %}" class="btn-cancel">
          <i class="fas fa-arrow-left"></i> Cancel — Keep My Plan
        </a>
      </div>

    </form>

  </div>
</div><!-- /.delete-view-wrapper -->

<style>
  #confirm_text:focus {
    border-color: #dc2626 !important;
    box-shadow: 0 0 0 3px rgba(220, 38, 38, .1) !important;
    background: var(--purewhite-color) !important;
  }
</style>

<script>
  document.getElementById('deleteForm').addEventListener('submit', function () {
    var btn = document.getElementById('delete-btn');
    btn.disabled    = true;
    btn.textContent = 'Deleting…';
  });
</script>
{% endblock %}