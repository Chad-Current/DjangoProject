{% extends "dashboard/dashboard.html" %}
{% load static %}


{% block title %}Funeral Plan Summary{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'dashboard/css/onboard.css' %}">
{% endblock %}

{% block content %}
<div class="onboarding-wrap" style="grid-template-columns: 1fr; max-width: 960px;">

  {% if messages %}
    {% for message in messages %}
      <div class="ob-alert {% if message.tags == 'error' %}ob-alert-error{% elif message.tags == 'warning' %}ob-alert-warning{% else %}ob-alert-success{% endif %}">
        <i class="fas {% if message.tags == 'error' %}fa-circle-xmark{% elif message.tags == 'warning' %}fa-triangle-exclamation{% else %}fa-circle-check{% endif %}"></i>
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <!-- Page header -->
  <div class="ob-page-header{% if progress.is_complete %} ob-complete-header{% endif %}">
    {% if progress.is_complete %}
      <div class="ob-complete-trophy">üéóÔ∏è</div>
    {% endif %}
    <p class="ob-eyebrow">Estate Planning</p>
    <h1>Funeral Plan Summary</h1>
    <p>A complete record of your wishes across all eight planning sections.</p>
  </div>

  <!-- Action bar -->
  <div style="display:flex; gap:.75rem; flex-wrap:wrap; margin-bottom:1.25rem;">
    {% if can_modify %}
      <a href="{% url 'dashboard:funeralplan_index' %}" class="ob-btn ob-btn-primary">
        <i class="fas fa-pen"></i> Edit Plan
      </a>
    {% endif %}
    <a href="{% url 'dashboard:funeralplan_index' %}" class="ob-btn ob-btn-ghost">
      <i class="fas fa-grid-2"></i> Overview
    </a>
    <button onclick="window.print()" class="ob-btn ob-btn-ghost">
      <i class="fas fa-print"></i> Print
    </button>
    <span style="flex:1"></span>
    {% if can_modify %}
      <a href="{% url 'dashboard:funeralplan_delete' %}"
         class="ob-btn ob-btn-ghost" style="color:#c0392b; border-color:#fecaca;">
        <i class="fas fa-trash"></i> Delete Plan
      </a>
    {% endif %}
    <a href="{% url 'dashboard:dashboard_home' %}" class="ob-btn ob-btn-ghost">
      <i class="fas fa-arrow-left"></i> Dashboard
    </a>
  </div>

  <!-- ‚îÄ‚îÄ Sections ‚îÄ‚îÄ -->
  <div class="ob-complete-card">

    <!-- Progress count row -->
    <div class="ob-count-grid">
      <div class="ob-count-cell accent-blue">
        <div class="ob-count-emoji">ü™™</div>
        <div class="ob-count-number">{% if progress.personal_info %}‚úì{% else %}‚Äî{% endif %}</div>
        <div class="ob-count-label">Personal Info</div>
      </div>
      <div class="ob-count-cell accent-navy">
        <div class="ob-count-emoji">‚õ™</div>
        <div class="ob-count-number">{% if progress.service %}‚úì{% else %}‚Äî{% endif %}</div>
        <div class="ob-count-label">Service Prefs</div>
      </div>
      <div class="ob-count-cell accent-amber">
        <div class="ob-count-emoji">üåø</div>
        <div class="ob-count-number">{% if progress.disposition %}‚úì{% else %}‚Äî{% endif %}</div>
        <div class="ob-count-label">Disposition</div>
      </div>
      <div class="ob-count-cell accent-amber">
        <div class="ob-count-emoji">üéµ</div>
        <div class="ob-count-number">{% if progress.ceremony %}‚úì{% else %}‚Äî{% endif %}</div>
        <div class="ob-count-label">Ceremony</div>
      </div>
      <div class="ob-count-cell accent-navy">
        <div class="ob-count-emoji">ü§ù</div>
        <div class="ob-count-number">{% if progress.reception %}‚úì{% else %}‚Äî{% endif %}</div>
        <div class="ob-count-label">Reception</div>
      </div>
      <div class="ob-count-cell accent-blue">
        <div class="ob-count-emoji">üì∞</div>
        <div class="ob-count-number">{% if progress.obituary %}‚úì{% else %}‚Äî{% endif %}</div>
        <div class="ob-count-label">Obituary</div>
      </div>
    </div>

    <div class="ob-complete-cta">
      <p>
        {% if progress.is_complete %}
          Your funeral plan is complete. Your loved ones will have clear guidance when the time comes.
        {% else %}
          Complete all sections to ensure your wishes are clearly documented for your loved ones.
        {% endif %}
      </p>
      {% if can_modify %}
        <a href="{% url 'dashboard:funeralplan_step1' %}" class="ob-btn ob-btn-primary">
          <i class="fas fa-pen"></i> Continue Editing
        </a>
      {% endif %}
    </div>

  </div><!-- /.ob-complete-card -->

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       DETAIL SECTIONS
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

  <!-- 1 ‚Äî Personal Information -->
  <div class="ob-form-card" style="margin-top: 1rem;">
    <div class="ob-card-heading">
      <div class="ob-card-icon">ü™™</div>
      1 ‚Äî Personal Information
      {% if can_modify %}
        <a href="{% url 'dashboard:funeralplan_step1' %}" class="ob-btn ob-btn-ghost" style="margin-left:auto; font-size: var(--font-sm);">
          <i class="fas fa-pen"></i> Edit
        </a>
      {% endif %}
    </div>
    {% if has_personal_info %}
      <div class="ob-grid">
        {% if plan.preferred_name %}
          <div class="ob-field">
            <label class="form-label">Preferred Name</label>
            <div class="ob-items"><div class="ob-item"><div class="ob-item-body"><div class="ob-item-name">{{ plan.preferred_name }}</div></div></div></div>
          </div>
        {% endif %}
        {% if plan.occupation %}
          <div class="ob-field">
            <label class="form-label">Occupation</label>
            <div class="ob-items"><div class="ob-item"><div class="ob-item-body"><div class="ob-item-name">{{ plan.occupation }}</div></div></div></div>
          </div>
        {% endif %}
        {% if plan.marital_status %}
          <div class="ob-field">
            <label class="form-label">Marital Status</label>
            <div class="ob-items"><div class="ob-item"><div class="ob-item-body"><div class="ob-item-name">{{ plan.marital_status }}</div></div></div></div>
          </div>
        {% endif %}
        {% if plan.religion_or_spiritual_affiliation %}
          <div class="ob-field">
            <label class="form-label">Religion / Affiliation</label>
            <div class="ob-items"><div class="ob-item"><div class="ob-item-body"><div class="ob-item-name">{{ plan.religion_or_spiritual_affiliation }}</div></div></div></div>
          </div>
        {% endif %}
        <div class="ob-field">
          <label class="form-label">Veteran</label>
          {% if plan.is_veteran %}
            <span class="ob-badge badge-blue">‚úì Yes{% if plan.veteran_branch %} ‚Äî {{ plan.veteran_branch }}{% endif %}</span>
          {% else %}
            <span class="ob-badge badge-navy">No</span>
          {% endif %}
        </div>
      </div>
    {% else %}
      <div class="ob-empty">
        <div class="ob-empty-icon">ü™™</div>
        <p>No personal information recorded yet.</p>
        {% if can_modify %}<a href="{% url 'dashboard:funeralplan_step1' %}" class="ob-btn ob-btn-ghost" style="margin-top:.75rem;">Add now</a>{% endif %}
      </div>
    {% endif %}
  </div>

  <!-- 2 ‚Äî Service Preferences -->
  <div class="ob-form-card" style="margin-top: 1rem;">
    <div class="ob-card-heading">
      <div class="ob-card-icon">‚õ™</div>
      2 ‚Äî Service Preferences
      {% if can_modify %}
        <a href="{% url 'dashboard:funeralplan_step2' %}" class="ob-btn ob-btn-ghost" style="margin-left:auto; font-size: var(--font-sm);">
          <i class="fas fa-pen"></i> Edit
        </a>
      {% endif %}
    </div>
    {% if has_service_prefs %}
      <div class="ob-grid">
        {% if plan.service_type %}<div class="ob-field"><label class="form-label">Service Type</label><div class="ob-item-name">{{ plan.service_type }}</div></div>{% endif %}
        {% if plan.preferred_funeral_home %}<div class="ob-field"><label class="form-label">Funeral Home</label><div class="ob-item-name">{{ plan.preferred_funeral_home }}</div></div>{% endif %}
        {% if plan.funeral_home_phone %}<div class="ob-field"><label class="form-label">Phone</label><div class="ob-item-name">{{ plan.funeral_home_phone }}</div></div>{% endif %}
        {% if plan.desired_timing %}<div class="ob-field"><label class="form-label">Preferred Timing</label><div class="ob-item-name">{{ plan.desired_timing }}</div></div>{% endif %}
        {% if plan.open_casket_viewing %}<div class="ob-field"><label class="form-label">Viewing</label><div class="ob-item-name">{{ plan.open_casket_viewing }}</div></div>{% endif %}
        {% if plan.officiant_name_freetext %}<div class="ob-field"><label class="form-label">Officiant</label><div class="ob-item-name">{{ plan.officiant_name_freetext }}</div></div>{% endif %}
        {% if plan.funeral_home_address %}<div class="ob-field ob-full"><label class="form-label">Funeral Home Address</label><div class="ob-item-name">{{ plan.funeral_home_address }}</div></div>{% endif %}
        {% if plan.preferred_venue %}<div class="ob-field ob-full"><label class="form-label">Preferred Venue</label><div class="ob-item-name">{{ plan.preferred_venue }}</div></div>{% endif %}
      </div>
    {% else %}
      <div class="ob-empty">
        <div class="ob-empty-icon">‚õ™</div>
        <p>No service preferences recorded.</p>
        {% if can_modify %}<a href="{% url 'dashboard:funeralplan_step2' %}" class="ob-btn ob-btn-ghost" style="margin-top:.75rem;">Add now</a>{% endif %}
      </div>
    {% endif %}
  </div>

  <!-- 3 ‚Äî Final Disposition -->
  <div class="ob-form-card" style="margin-top: 1rem;">
    <div class="ob-card-heading">
      <div class="ob-card-icon">üåø</div>
      3 ‚Äî Final Disposition
      {% if can_modify %}
        <a href="{% url 'dashboard:funeralplan_step3' %}" class="ob-btn ob-btn-ghost" style="margin-left:auto; font-size: var(--font-sm);">
          <i class="fas fa-pen"></i> Edit
        </a>
      {% endif %}
    </div>
    {% if has_disposition %}
      <div class="ob-grid">
        {% if plan.disposition_method %}<div class="ob-field"><label class="form-label">Method</label><div class="ob-item-name">{{ plan.disposition_method }}</div></div>{% endif %}
        <div class="ob-field"><label class="form-label">Plot / Niche Purchased</label>
          {% if plan.burial_plot_or_niche_purchased is True %}<span class="ob-badge badge-blue">‚úì Yes</span>
          {% elif plan.burial_plot_or_niche_purchased is False %}<span class="ob-badge badge-navy">No</span>
          {% else %}<span class="ob-badge">‚Äî</span>{% endif %}
        </div>
        {% if plan.casket_type_preference %}<div class="ob-field"><label class="form-label">Casket Preference</label><div class="ob-item-name">{{ plan.casket_type_preference }}</div></div>{% endif %}
        {% if plan.urn_type_preference %}<div class="ob-field"><label class="form-label">Urn Preference</label><div class="ob-item-name">{{ plan.urn_type_preference }}</div></div>{% endif %}
        {% if plan.burial_or_interment_location %}<div class="ob-field ob-full"><label class="form-label">Location</label><div class="ob-item-name">{{ plan.burial_or_interment_location }}</div></div>{% endif %}
        {% if plan.headstone_or_marker_inscription %}<div class="ob-field ob-full"><label class="form-label">Inscription Ideas</label><div class="ob-item-name" style="white-space:pre-line;">{{ plan.headstone_or_marker_inscription }}</div></div>{% endif %}
      </div>
    {% else %}
      <div class="ob-empty">
        <div class="ob-empty-icon">üåø</div>
        <p>No disposition preferences recorded.</p>
        {% if can_modify %}<a href="{% url 'dashboard:funeralplan_step3' %}" class="ob-btn ob-btn-ghost" style="margin-top:.75rem;">Add now</a>{% endif %}
      </div>
    {% endif %}
  </div>

  <!-- 4 ‚Äî Ceremony -->
  <div class="ob-form-card" style="margin-top: 1rem;">
    <div class="ob-card-heading">
      <div class="ob-card-icon">üéµ</div>
      4 ‚Äî Ceremony Personalization
      {% if can_modify %}
        <a href="{% url 'dashboard:funeralplan_step4' %}" class="ob-btn ob-btn-ghost" style="margin-left:auto; font-size: var(--font-sm);">
          <i class="fas fa-pen"></i> Edit
        </a>
      {% endif %}
    </div>
    {% if has_ceremony %}
      <div class="ob-grid">
        {% if plan.flowers_or_colors %}<div class="ob-field"><label class="form-label">Flowers / Colors</label><div class="ob-item-name">{{ plan.flowers_or_colors }}</div></div>{% endif %}
        {% if plan.clothing_or_jewelry_description %}<div class="ob-field"><label class="form-label">Clothing / Jewelry</label><div class="ob-item-name">{{ plan.clothing_or_jewelry_description }}</div></div>{% endif %}
        {% if plan.music_choices %}<div class="ob-field ob-full"><label class="form-label">Music</label><div class="ob-item-name" style="white-space:pre-line;">{{ plan.music_choices }}</div></div>{% endif %}
        {% if plan.readings_poems_or_scriptures %}<div class="ob-field ob-full"><label class="form-label">Readings / Poems</label><div class="ob-item-name" style="white-space:pre-line;">{{ plan.readings_poems_or_scriptures }}</div></div>{% endif %}
        {% if plan.eulogists_notes %}<div class="ob-field ob-full"><label class="form-label">Eulogists / Speakers</label><div class="ob-item-name" style="white-space:pre-line;">{{ plan.eulogists_notes }}</div></div>{% endif %}
        {% if plan.pallbearers_notes %}<div class="ob-field ob-full"><label class="form-label">Pallbearers</label><div class="ob-item-name" style="white-space:pre-line;">{{ plan.pallbearers_notes }}</div></div>{% endif %}
        {% if plan.religious_cultural_customs %}<div class="ob-field ob-full"><label class="form-label">Religious / Cultural Customs</label><div class="ob-item-name" style="white-space:pre-line;">{{ plan.religious_cultural_customs }}</div></div>{% endif %}
        {% if plan.items_to_display %}<div class="ob-field ob-full"><label class="form-label">Items to Display</label><div class="ob-item-name" style="white-space:pre-line;">{{ plan.items_to_display }}</div></div>{% endif %}
      </div>
    {% else %}
      <div class="ob-empty">
        <div class="ob-empty-icon">üéµ</div>
        <p>No ceremony preferences recorded.</p>
        {% if can_modify %}<a href="{% url 'dashboard:funeralplan_step4' %}" class="ob-btn ob-btn-ghost" style="margin-top:.75rem;">Add now</a>{% endif %}
      </div>
    {% endif %}
  </div>

  <!-- 5 ‚Äî Reception -->
  <div class="ob-form-card" style="margin-top: 1rem;">
    <div class="ob-card-heading">
      <div class="ob-card-icon">ü§ù</div>
      5 ‚Äî Reception / Gathering
      {% if can_modify %}
        <a href="{% url 'dashboard:funeralplan_step5' %}" class="ob-btn ob-btn-ghost" style="margin-left:auto; font-size: var(--font-sm);">
          <i class="fas fa-pen"></i> Edit
        </a>
      {% endif %}
    </div>
    {% if has_reception %}
      <div class="ob-grid">
        <div class="ob-field"><label class="form-label">Gathering Desired</label>
          {% if plan.reception_desired is True %}<span class="ob-badge badge-blue">‚úì Yes</span>
          {% elif plan.reception_desired is False %}<span class="ob-badge badge-navy">No</span>
          {% else %}<span class="ob-badge">Not specified</span>{% endif %}
        </div>
        {% if plan.reception_location %}<div class="ob-field ob-full"><label class="form-label">Location</label><div class="ob-item-name">{{ plan.reception_location }}</div></div>{% endif %}
        {% if plan.reception_food_preferences %}<div class="ob-field ob-full"><label class="form-label">Food / Catering</label><div class="ob-item-name" style="white-space:pre-line;">{{ plan.reception_food_preferences }}</div></div>{% endif %}
        {% if plan.reception_atmosphere_notes %}<div class="ob-field ob-full"><label class="form-label">Atmosphere / Music</label><div class="ob-item-name" style="white-space:pre-line;">{{ plan.reception_atmosphere_notes }}</div></div>{% endif %}
        {% if plan.reception_guest_list_notes %}<div class="ob-field ob-full"><label class="form-label">Guest List Notes</label><div class="ob-item-name" style="white-space:pre-line;">{{ plan.reception_guest_list_notes }}</div></div>{% endif %}
      </div>
    {% else %}
      <div class="ob-empty">
        <div class="ob-empty-icon">ü§ù</div>
        <p>No reception preferences recorded.</p>
        {% if can_modify %}<a href="{% url 'dashboard:funeralplan_step5' %}" class="ob-btn ob-btn-ghost" style="margin-top:.75rem;">Add now</a>{% endif %}
      </div>
    {% endif %}
  </div>

  <!-- 6 ‚Äî Obituary -->
  <div class="ob-form-card" style="margin-top: 1rem;">
    <div class="ob-card-heading">
      <div class="ob-card-icon">üì∞</div>
      6 ‚Äî Obituary &amp; Memorial
      {% if can_modify %}
        <a href="{% url 'dashboard:funeralplan_step6' %}" class="ob-btn ob-btn-ghost" style="margin-left:auto; font-size: var(--font-sm);">
          <i class="fas fa-pen"></i> Edit
        </a>
      {% endif %}
    </div>
    {% if has_obituary %}
      <div class="ob-grid">
        {% if plan.obituary_photo_description %}<div class="ob-field ob-full"><label class="form-label">Photo Preference</label><div class="ob-item-name">{{ plan.obituary_photo_description }}</div></div>{% endif %}
        {% if plan.obituary_key_achievements %}<div class="ob-field ob-full"><label class="form-label">Key Achievements / Memories</label><div class="ob-item-name" style="white-space:pre-line;">{{ plan.obituary_key_achievements }}</div></div>{% endif %}
        {% if plan.obituary_publications %}<div class="ob-field ob-full"><label class="form-label">Publications / Websites</label><div class="ob-item-name">{{ plan.obituary_publications }}</div></div>{% endif %}
        {% if plan.charitable_donations_in_lieu %}<div class="ob-field ob-full"><label class="form-label">Charitable Donations in Lieu</label><div class="ob-item-name">{{ plan.charitable_donations_in_lieu }}</div></div>{% endif %}
      </div>
    {% else %}
      <div class="ob-empty">
        <div class="ob-empty-icon">üì∞</div>
        <p>No obituary information recorded.</p>
        {% if can_modify %}<a href="{% url 'dashboard:funeralplan_step6' %}" class="ob-btn ob-btn-ghost" style="margin-top:.75rem;">Add now</a>{% endif %}
      </div>
    {% endif %}
  </div>

  <!-- 7 ‚Äî Administrative -->
  <div class="ob-form-card" style="margin-top: 1rem;">
    <div class="ob-card-heading">
      <div class="ob-card-icon">üìã</div>
      7 ‚Äî Administrative &amp; Financial
      {% if can_modify %}
        <a href="{% url 'dashboard:funeralplan_step7' %}" class="ob-btn ob-btn-ghost" style="margin-left:auto; font-size: var(--font-sm);">
          <i class="fas fa-pen"></i> Edit
        </a>
      {% endif %}
    </div>
    {% if has_admin %}
      <div class="ob-grid">
        {% if plan.funeral_insurance_policy_number %}<div class="ob-field"><label class="form-label">Insurance Policy #</label><div class="ob-item-name">{{ plan.funeral_insurance_policy_number }}</div></div>{% endif %}
        {% if plan.death_certificates_requested %}<div class="ob-field"><label class="form-label">Death Certificates Needed</label><div class="ob-item-name">{{ plan.death_certificates_requested }}</div></div>{% endif %}
        <div class="ob-field"><label class="form-label">Review Reminder</label><div class="ob-item-name">Every {{ plan.review_time }} days</div></div>
        {% if plan.payment_arrangements %}<div class="ob-field ob-full"><label class="form-label">Payment Arrangements</label><div class="ob-item-name" style="white-space:pre-line;">{{ plan.payment_arrangements }}</div></div>{% endif %}
      </div>
    {% else %}
      <div class="ob-empty">
        <div class="ob-empty-icon">üìã</div>
        <p>No administrative details recorded.</p>
        {% if can_modify %}<a href="{% url 'dashboard:funeralplan_step7' %}" class="ob-btn ob-btn-ghost" style="margin-top:.75rem;">Add now</a>{% endif %}
      </div>
    {% endif %}
  </div>

  <!-- 8 ‚Äî Additional Instructions -->
  <div class="ob-form-card" style="margin-top: 1rem;">
    <div class="ob-card-heading">
      <div class="ob-card-icon">‚úâÔ∏è</div>
      8 ‚Äî Additional Instructions
      {% if can_modify %}
        <a href="{% url 'dashboard:funeralplan_step8' %}" class="ob-btn ob-btn-ghost" style="margin-left:auto; font-size: var(--font-sm);">
          <i class="fas fa-pen"></i> Edit
        </a>
      {% endif %}
    </div>
    {% if has_instructions %}
      <p style="white-space:pre-line; margin:0; font-family: var(--paragraph-font); font-size: var(--font-nm); font-weight:300; color: var(--text-color-dark);">{{ plan.additional_instructions }}</p>
    {% else %}
      <div class="ob-empty">
        <div class="ob-empty-icon">‚úâÔ∏è</div>
        <p>No additional instructions recorded.</p>
        {% if can_modify %}<a href="{% url 'dashboard:funeralplan_step8' %}" class="ob-btn ob-btn-ghost" style="margin-top:.75rem;">Add now</a>{% endif %}
      </div>
    {% endif %}
  </div>

  <!-- Footer -->
  <div style="display:flex; gap:.75rem; flex-wrap:wrap; margin-top:0.5rem; padding-top:1rem;">
    <a href="{% url 'dashboard:funeralplan_index' %}" class="ob-btn ob-btn-primary">
      <i class="fas fa-arrow-left"></i> Back to Overview
    </a>
    <a href="{% url 'dashboard:dashboard_home' %}" class="ob-btn ob-btn-ghost">Dashboard</a>
    <button onclick="window.print()" class="ob-btn ob-btn-ghost">Print Summary</button>
  </div>

</div><!-- /.onboarding-wrap -->

<style>
  @media print {
    .ob-btn, [onclick] { display: none !important; }
  }
</style>
{% endblock %}