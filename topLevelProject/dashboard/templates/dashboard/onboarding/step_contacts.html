<!-- step_contacts.html -->

{% extends "dashboard/onboarding/base_onboarding.html" %}
{% block title %}Step 1 ‚Äî Add Your Contacts{% endblock %}


{% block ob_content %}
<div class="ob-page-header">
  <div class="ob-eyebrow">Step 1 of 6</div>
  <h1>Who needs to know?</h1>
  <p>Add the family members, executors, advisors, and caregivers who should be informed and given access after you're gone.</p>
</div>

<div class="ob-body">

  <!-- ‚îÄ‚îÄ FORM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <form method="post" novalidate>
    {% csrf_token %}
    <div class="ob-form-card">
      <div class="ob-card-heading">
        <div class="ob-card-icon"><i class="fas fa-user-plus"></i></div>
        Add a Contact
      </div>

      <div class="ob-grid">

        {# first_name #}
        <div class="ob-field{% if form.first_name.errors %} has-error{% endif %}">
          <label for="{{ form.first_name.id_for_label }}"
            class="ob-label-tooltip"
            title="The contact's legal first name as it appears on official documents.">
            First Name <span class="req" aria-hidden="true">*</span>
            <span class="ob-tip" role="tooltip">The contact's legal first name as it appears on official documents.</span>
          </label>
          {{ form.first_name }}
          {% if form.first_name.errors %}
          <ul class="errorlist" role="alert">
            {% for e in form.first_name.errors %}<li>{{ e }}</li>{% endfor %}
          </ul>
          {% endif %}
        </div>

        {# last_name #}
        <div class="ob-field{% if form.last_name.errors %} has-error{% endif %}">
          <label for="{{ form.last_name.id_for_label }}"
            class="ob-label-tooltip"
            title="The contact's legal last name or family name.">
            Last Name <span class="req" aria-hidden="true">*</span>
            <span class="ob-tip" role="tooltip">The contact's legal last name or family name.</span>
          </label>
          {{ form.last_name }}
          {% if form.last_name.errors %}
          <ul class="errorlist" role="alert">
            {% for e in form.last_name.errors %}<li>{{ e }}</li>{% endfor %}
          </ul>
          {% endif %}
        </div>

        {# contact_relation #}
        <div class="ob-field{% if form.contact_relation.errors %} has-error{% endif %}">
          <label for="{{ form.contact_relation.id_for_label }}"
            class="ob-label-tooltip"
            title="How this person relates to you ‚Äî e.g. Spouse, Son, Daughter, Attorney. Helps your family understand the context of each contact.">
            Relationship <span class="req" aria-hidden="true">*</span>
            <span class="ob-tip" role="tooltip">How this person relates to you ‚Äî e.g. Spouse, Son, Attorney. Helps your family understand the context of each contact.</span>
          </label>
          {{ form.contact_relation }}
          {% if form.contact_relation.errors %}
          <ul class="errorlist" role="alert">
            {% for e in form.contact_relation.errors %}<li>{{ e }}</li>{% endfor %}
          </ul>
          {% endif %}
        </div>

        {# email #}
        <div class="ob-field{% if form.email.errors %} has-error{% endif %}">
          <label for="{{ form.email.id_for_label }}"
            class="ob-label-tooltip"
            title="The best email address to reach this contact. Used when your family needs to notify or share information with them.">
            Email Address
            <span class="ob-tip" role="tooltip">The best email address to reach this contact. Used when your family needs to notify or share information with them.</span>
          </label>
          {{ form.email }}
          {% if form.email.errors %}
          <ul class="errorlist" role="alert">
            {% for e in form.email.errors %}<li>{{ e }}</li>{% endfor %}
          </ul>
          {% endif %}
        </div>

        {# phone #}
        <div class="ob-field{% if form.phone.errors %} has-error{% endif %}">
          <label for="{{ form.phone.id_for_label }}"
            class="ob-label-tooltip"
            title="A reliable phone number for this contact ‚Äî mobile preferred for urgent situations like emergencies.">
            Phone Number
            <span class="ob-tip" role="tooltip">A reliable phone number for this contact ‚Äî mobile preferred for urgent situations like emergencies.</span>
          </label>
          {{ form.phone }}
          {% if form.phone.errors %}
          <ul class="errorlist" role="alert">
            {% for e in form.phone.errors %}<li>{{ e }}</li>{% endfor %}
          </ul>
          {% endif %}
        </div>

        {# address_1 #}
        <div class="ob-field{% if form.address_1.errors %} has-error{% endif %}">
          <label for="{{ form.address_1.id_for_label }}"
            class="ob-label-tooltip"
            title="The contact's current street address ‚Äî useful for mailing legal documents or notices to them.">
            Street Address <span class="req" aria-hidden="true">*</span>
            <span class="ob-tip" role="tooltip">The contact's current street address ‚Äî useful for mailing legal documents or notices to them.</span>
          </label>
          {{ form.address_1 }}
          {% if form.address_1.errors %}
          <ul class="errorlist" role="alert">
            {% for e in form.address_1.errors %}<li>{{ e }}</li>{% endfor %}
          </ul>
          {% endif %}
        </div>

        {# address_2 #}
        <div class="ob-field{% if form.address_2.errors %} has-error{% endif %}">
          <label for="{{ form.address_2.id_for_label }}"
            class="ob-label-tooltip"
            title="Apartment, suite, unit, or building number if applicable.">
            Address Line 2
            <span class="ob-tip" role="tooltip">Apartment, suite, unit, or building number if applicable.</span>
          </label>
          {{ form.address_2 }}
          {% if form.address_2.errors %}
          <ul class="errorlist" role="alert">
            {% for e in form.address_2.errors %}<li>{{ e }}</li>{% endfor %}
          </ul>
          {% endif %}
        </div>

        {# city #}
        <div class="ob-field{% if form.city.errors %} has-error{% endif %}">
          <label for="{{ form.city.id_for_label }}"
            class="ob-label-tooltip"
            title="The city or town where this contact currently resides.">
            City <span class="req" aria-hidden="true">*</span>
            <span class="ob-tip" role="tooltip">The city or town where this contact currently resides.</span>
          </label>
          {{ form.city }}
          {% if form.city.errors %}
          <ul class="errorlist" role="alert">
            {% for e in form.city.errors %}<li>{{ e }}</li>{% endfor %}
          </ul>
          {% endif %}
        </div>

        {# state #}
        <div class="ob-field{% if form.state.errors %} has-error{% endif %}">
          <label for="{{ form.state.id_for_label }}"
            class="ob-label-tooltip"
            title="State or province of this contact's address. Important for jurisdiction in legal or estate matters.">
            State <span class="req" aria-hidden="true">*</span>
            <span class="ob-tip" role="tooltip">State or province of this contact's address. Important for jurisdiction in legal or estate matters.</span>
          </label>
          {{ form.state }}
          {% if form.state.errors %}
          <ul class="errorlist" role="alert">
            {% for e in form.state.errors %}<li>{{ e }}</li>{% endfor %}
          </ul>
          {% endif %}
        </div>

      </div>{# end ob-grid #}

      <!-- ‚îÄ‚îÄ ROLES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <div class="ob-roles-section{% if form.non_field_errors %} has-error{% endif %}">
        <div class="ob-roles-header">
          <label class="roles-label">Roles <span class="req asterisk" aria-hidden="true"></span></label>
          <span class="ob-roles-hint">Select all that apply ‚Äî hover each for a description</span>
        </div>

        {% if form.non_field_errors %}
        <ul class="errorlist" role="alert" style="margin-bottom: 0.75rem;">
          {% for error in form.non_field_errors %}<li>{{ error }}</li>{% endfor %}
        </ul>
        {% endif %}

        <!-- Legal & Estate -->
        <div class="ob-role-group">
          <div class="ob-role-group-label">
            <i class="fas fa-balance-scale"></i> Legal &amp; Estate
          </div>
          <div class="ob-check-group ob-check-group-4">

            <label class="ob-check-row ob-label-tooltip"
              title="Named executor/personal representative to administer overall estate and will.">
              {{ form.is_legal_executor }}
              <span class="ob-check-label">Legal Executor</span>
              <span class="ob-tip" role="tooltip">Named executor/personal representative to administer overall estate and will.</span>
            </label>

            <label class="ob-check-row ob-label-tooltip"
              title="Responsible for managing digital assets (accounts, passwords, online services) after death.">
              {{ form.is_digital_executor }}
              <span class="ob-check-label">Digital Executor</span>
              <span class="ob-tip" role="tooltip">Responsible for managing digital assets (accounts, passwords, online services) after death.</span>
            </label>

            <label class="ob-check-row ob-label-tooltip"
              title="Manages trusts, distributions, and trust assets according to trust terms.">
              {{ form.is_trustee }}
              <span class="ob-check-label">Trustee</span>
              <span class="ob-tip" role="tooltip">Manages trusts, distributions, and trust assets according to trust terms.</span>
            </label>

            <label class="ob-check-row ob-label-tooltip"
              title="Attorney, accountant, or advisor to consult for legal/financial guidance.">
              {{ form.is_professional_advisor }}
              <span class="ob-check-label">Professional Advisor</span>
              <span class="ob-tip" role="tooltip">Attorney, accountant, or advisor to consult for legal/financial guidance.</span>
            </label>

          </div>
        </div>

        <!-- Medical & Care -->
        <div class="ob-role-group">
          <div class="ob-role-group-label">
            <i class="fas fa-heartbeat"></i> Medical &amp; Care
          </div>
          <div class="ob-check-group ob-check-group-4">

            <label class="ob-check-row ob-label-tooltip"
              title="Contact to notify and provide access during medical emergencies or sudden incapacity.">
              {{ form.is_emergency_contact }}
              <span class="ob-check-label">Emergency Contact</span>
              <span class="ob-tip" role="tooltip">Contact to notify and provide access during medical emergencies or sudden incapacity.</span>
            </label>

            <label class="ob-check-row ob-label-tooltip"
              title="Makes medical decisions if you're unable to communicate (healthcare power of attorney).">
              {{ form.is_healthcare_proxy }}
              <span class="ob-check-label">Healthcare Proxy</span>
              <span class="ob-tip" role="tooltip">Makes medical decisions if you're unable to communicate (healthcare power of attorney).</span>
            </label>

            <label class="ob-check-row ob-label-tooltip"
              title="Primary person providing or coordinating long-term care needs and health decisions.">
              {{ form.is_caregiver }}
              <span class="ob-check-label">Caregiver</span>
              <span class="ob-tip" role="tooltip">Primary person providing or coordinating long-term care needs and health decisions.</span>
            </label>

            <label class="ob-check-row ob-label-tooltip"
              title="Named legal guardian for minor children or dependent adults.">
              {{ form.is_guardian_for_dependents }}
              <span class="ob-check-label">Guardian</span>
              <span class="ob-tip" role="tooltip">Named legal guardian for minor children or dependent adults.</span>
            </label>

          </div>
        </div>

        <!-- Financial & Access -->
        <div class="ob-role-group">
          <div class="ob-role-group-label">
            <i class="fas fa-dollar-sign"></i> Financial &amp; Access
          </div>
          <div class="ob-check-group ob-check-group-4">

            <label class="ob-check-row ob-label-tooltip"
              title="Authorized under financial power of attorney to handle money/bills if incapacitated.">
              {{ form.is_financial_agent }}
              <span class="ob-check-label">Financial Agent</span>
              <span class="ob-tip" role="tooltip">Authorized under financial power of attorney to handle money/bills if incapacitated.</span>
            </label>

            <label class="ob-check-row ob-label-tooltip"
              title="Designated for platform-specific legacy access (e.g., Apple, Google, Facebook).">
              {{ form.is_legacy_contact }}
              <span class="ob-check-label">Legacy Contact</span>
              <span class="ob-tip" role="tooltip">Designated for platform-specific legacy access (e.g., Apple, Google, Facebook).</span>
            </label>

            <label class="ob-check-row ob-label-tooltip"
              title="Delegated specific knowledge/info (e.g., account locations) but no action required.">
              {{ form.is_knowledge_contact }}
              <span class="ob-check-label">Knowledge Contact</span>
              <span class="ob-tip" role="tooltip">Delegated specific knowledge/info (e.g., account locations) but no action required.</span>
            </label>

            <label class="ob-check-row ob-label-tooltip"
              title="Receives notifications and basic info but has no decision-making authority or tasks.">
              {{ form.is_notification_only }}
              <span class="ob-check-label">Notification Only</span>
              <span class="ob-tip" role="tooltip">Receives notifications and basic info but has no decision-making authority or tasks.</span>
            </label>

          </div>
        </div>

        <!-- Personal -->
        <div class="ob-role-group ob-role-group-last">
          <div class="ob-role-group-label">
            <i class="fas fa-heart"></i> Personal
          </div>
          <div class="ob-check-group ob-check-group-4">

            <label class="ob-check-row ob-label-tooltip"
              title="Handles funeral, memorial service, and burial/cremation preferences.">
              {{ form.is_memorial_contact }}
              <span class="ob-check-label">Memorial Contact</span>
              <span class="ob-tip" role="tooltip">Handles funeral, memorial service, and burial/cremation preferences.</span>
            </label>

            <label class="ob-check-row ob-label-tooltip"
              title="Responsible for pet care, veterinary decisions, and related expenses.">
              {{ form.is_pet_caregiver }}
              <span class="ob-check-label">Pet Caregiver</span>
              <span class="ob-tip" role="tooltip">Responsible for pet care, veterinary decisions, and related expenses.</span>
            </label>

          </div>
        </div>

      </div>{# end ob-roles-section #}

      <div class="ob-actions">
        <button type="submit" class="ob-btn ob-btn-primary">
          <i class="fas fa-plus"></i> Add Contact
        </button>
        <div class="ob-spacer"></div>
        {% if contacts.count > 0 %}
        <a href="{% url 'dashboard:onboarding_accounts' %}" class="ob-btn ob-btn-accent">
          Continue to Accounts <i class="fas fa-arrow-right"></i>
        </a>
        {% endif %}
      </div>

    </div>{# end ob-form-card #}
  </form>

  <!-- ‚îÄ‚îÄ PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="ob-panel">
    <div class="ob-panel-card">
      <div class="ob-panel-label">Added Contacts ({{ contacts.count }})</div>

      {% if contacts %}
      <div class="ob-items">
        {% for contact in contacts %}
        <div class="ob-item">
          <div class="ob-item-icon">
            {% if contact.contact_relation == 'Spouse' %}üíë
            {% elif contact.contact_relation == 'Mother' or contact.contact_relation == 'Father' %}üë™
            {% elif contact.contact_relation == 'Son' or contact.contact_relation == 'Daughter' %}üë∂
            {% elif contact.contact_relation == 'Sister' or contact.contact_relation == 'Brother' %}üßë‚Äçü§ù‚Äçüßë
            {% elif contact.contact_relation == 'Self' %}ü™û
            {% else %}üë§{% endif %}
          </div>
          <div class="ob-item-body">
            <div class="ob-item-name">{{ contact.first_name }} {{ contact.last_name }}</div>
            <div class="ob-item-sub">
              {{ contact.contact_relation }}{% if contact.email %} ¬∑ {{ contact.email }}{% endif %}
            </div>
            <div class="ob-role-badges">
              {% if contact.is_legal_executor %}<span class="ob-badge badge-navy">Legal Exec</span>{% endif %}
              {% if contact.is_digital_executor %}<span class="ob-badge badge-navy">Digital Exec</span>{% endif %}
              {% if contact.is_trustee %}<span class="ob-badge badge-navy">Trustee</span>{% endif %}
              {% if contact.is_healthcare_proxy %}<span class="ob-badge badge-blue">Healthcare</span>{% endif %}
              {% if contact.is_financial_agent %}<span class="ob-badge badge-blue">Financial</span>{% endif %}
              {% if contact.is_emergency_contact %}<span class="ob-badge badge-amber">Emergency</span>{% endif %}
              {% if contact.is_caregiver %}<span class="ob-badge badge-blue">Caregiver</span>{% endif %}
              {% if contact.is_guardian_for_dependents %}<span class="ob-badge badge-navy">Guardian</span>{% endif %}
              {% if contact.is_memorial_contact %}<span class="ob-badge badge-blue">Memorial</span>{% endif %}
              {% if contact.is_legacy_contact %}<span class="ob-badge badge-blue">Legacy</span>{% endif %}
              {% if contact.is_pet_caregiver %}<span class="ob-badge badge-blue">Pets</span>{% endif %}
              {% if contact.is_professional_advisor %}<span class="ob-badge badge-navy">Advisor</span>{% endif %}
              {% if contact.is_knowledge_contact %}<span class="ob-badge badge-blue">Knowledge</span>{% endif %}
              {% if contact.is_notification_only %}<span class="ob-badge badge-blue">Notify</span>{% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      {% else %}
      <div class="ob-empty">
        <div class="ob-empty-icon"><i class="fas fa-users"></i></div>
        <p>No contacts yet.<br>Add your first contact to continue.</p>
      </div>
      {% endif %}

    </div>

    {% if contacts.count > 0 %}
    <a href="{% url 'dashboard:onboarding_accounts' %}" class="ob-btn ob-btn-blue ob-btn-full">
      Continue ‚Üí Accounts <i class="fas fa-arrow-right"></i>
    </a>
    {% else %}
    <p style="font-size: var(--font-sm); font-weight: 300; color: var(--thirty-percent); text-align: center; margin: 0;">
      <i class="fas fa-info-circle" style="margin-right: 5px;"></i>Add at least one contact to unlock Step 2.
    </p>
    {% endif %}

    <!-- ‚îÄ‚îÄ PANEL (ERRORS) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    {% if form.errors or form.non_field_errors %}
    <div class="ob-panel-card">
      <div class="ob-panel-label">
        {% if form.errors %}
        <div class="ob-error-summary" role="alert" aria-live="polite">
          <div class="ob-error-summary-title">
            <i class="fas fa-exclamation-triangle"></i>
            <p>Please fix the following before saving:</p>
          </div>
          <ul class="ob-error-summary-list">
            {% for field in form %}
              {% if field.errors %}
                {% for error in field.errors %}
                <li>{{ field.label }}</li>
                {% endfor %}
              {% endif %}
            {% endfor %}
            {% for error in form.non_field_errors %}
            <li>{{ error }}</li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </div>
    </div>
    {% endif %}
    {# end ob-panel errors #}

  </div>{# end ob-panel #}

</div>{# end ob-body #}

{% endblock %}