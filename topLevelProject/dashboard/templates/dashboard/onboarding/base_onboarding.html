{% extends "dashboard/base_dashboard.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'baseapp/css/index.css' %}" type="text/css">
<link rel="stylesheet" href="{% static 'dashboard/css/stylesheet.css' %}" type="text/css">
<link rel="stylesheet" href="{% static 'dashboard/css/onboard.css' %}" type="text/css">
{% endblock %}

{% block content %}
<div class="onboarding-wrap">

  <!-- ── STEP RAIL ──────────────────────────────────── -->
  <aside class="step-rail">
    <div class="rail-header">
      <h2>Setup Guide</h2>
      <p>Build your digital estate plan</p>
      <div class="rail-progress-track">
        <div class="rail-progress-fill"
             style="width: {% if step and total_steps %}{% widthratio step total_steps 100 %}{% else %}0{% endif %}%"></div>
      </div>
    </div>

    <div class="rail-steps">

      <div class="rail-step {% if step > 1 %}done{% elif step == 1 %}active{% else %}todo{% endif %}">
        <div class="rail-dot">
          {% if step > 1 %}<i class="fas fa-check"></i>{% else %}1{% endif %}
        </div>
        <div class="rail-text">
          <span class="rail-label">Contacts</span>
          <span class="rail-sub">People who matter most</span>
        </div>
        {% if progress.contacts > 0 %}<span class="rail-count">{{ progress.contacts }}</span>{% endif %}
      </div>

      <div class="rail-step {% if step > 2 %}done{% elif step == 2 %}active{% else %}todo{% endif %}">
        <div class="rail-dot">
          {% if step > 2 %}<i class="fas fa-check"></i>{% else %}2{% endif %}
        </div>
        <div class="rail-text">
          <span class="rail-label">Accounts</span>
          <span class="rail-sub">Your digital accounts</span>
        </div>
        {% if progress.accounts > 0 %}<span class="rail-count">{{ progress.accounts }}</span>{% endif %}
      </div>

      <div class="rail-step {% if step > 3 %}done{% elif step == 3 %}active{% else %}todo{% endif %}">
        <div class="rail-dot">
          {% if step > 3 %}<i class="fas fa-check"></i>{% else %}3{% endif %}
        </div>
        <div class="rail-text">
          <span class="rail-label">Devices</span>
          <span class="rail-sub">Physical devices</span>
        </div>
        {% if progress.devices > 0 %}<span class="rail-count">{{ progress.devices }}</span>{% endif %}
      </div>

      <div class="rail-step {% if step > 4 %}done{% elif step == 4 %}active{% else %}todo{% endif %}">
        <div class="rail-dot">
          {% if step > 4 %}<i class="fas fa-check"></i>{% else %}4{% endif %}
        </div>
        <div class="rail-text">
          <span class="rail-label">Estate Docs</span>
          <span class="rail-sub">Wills &amp; legal documents</span>
        </div>
        {% if progress.estates > 0 %}<span class="rail-count">{{ progress.estates }}</span>{% endif %}
      </div>

      <div class="rail-step {% if step > 5 %}done{% elif step == 5 %}active{% else %}todo{% endif %}">
        <div class="rail-dot">
          {% if step > 5 %}<i class="fas fa-check"></i>{% else %}5{% endif %}
        </div>
        <div class="rail-text">
          <span class="rail-label">Documents</span>
          <span class="rail-sub">Important documents</span>
        </div>
        {% if progress.documents > 0 %}<span class="rail-count">{{ progress.documents }}</span>{% endif %}
      </div>

      <div class="rail-step {% if step > 6 %}done{% elif step == 6 %}active{% else %}todo{% endif %}">
        <div class="rail-dot">
          {% if step > 6 %}<i class="fas fa-check"></i>{% else %}6{% endif %}
        </div>
        <div class="rail-text">
          <span class="rail-label">Family Notes</span>
          <span class="rail-sub">Guidance for loved ones</span>
        </div>
        {% if progress.family_knows > 0 %}<span class="rail-count">{{ progress.family_knows }}</span>{% endif %}
      </div>

      <div class="rail-footer">
        <a href="{% url 'dashboard:dashboard_home' %}">
          <i class="fas fa-arrow-left"></i> Skip to dashboard
        </a>
      </div>

    </div>
  </aside>

  <!-- ── MAIN CONTENT ────────────────────────────────── -->
  <main class="onboarding-main">

    {% if messages %}
      {% for message in messages %}
      <div class="ob-alert ob-alert-{% if message.tags %}{{ message.tags }}{% else %}success{% endif %}">
        {% if 'success' in message.tags %}<i class="fas fa-check-circle"></i>
        {% elif 'warning' in message.tags %}<i class="fas fa-exclamation-triangle"></i>
        {% elif 'error'   in message.tags %}<i class="fas fa-times-circle"></i>
        {% endif %}
        {{ message }}
      </div>
      {% endfor %}
    {% endif %}

    {% block ob_content %}{% endblock %}
  </main>

</div>
{% endblock %}