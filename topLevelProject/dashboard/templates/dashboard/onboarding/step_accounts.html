{% extends "dashboard/onboarding/base_onboarding.html" %}
{% block title %}Step 2 ‚Äî Add Your Accounts{% endblock %}

{% block ob_content %}
<div class="ob-page-header">
  <div class="ob-eyebrow">Step 2 of 6</div>
  <h1>Your digital accounts.</h1>
  <p>Add the online accounts your family should know about ‚Äî email, banking, social media, and more. No passwords needed.</p>
</div>

<div class="ob-body">

  <!-- ‚îÄ‚îÄ FORM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <form method="post" novalidate>
    {% csrf_token %}
    <div class="ob-form-card">
      <div class="ob-card-heading">
        <div class="ob-card-icon"><i class="fas fa-plus-circle"></i></div>
        Add an Account
      </div>

      <div class="ob-grid">

        {# Provider #}
        <div class="ob-field{% if form.account_name_or_provider.errors %} has-error{% endif %}">
          <label
            for="{{ form.account_name_or_provider.id_for_label }}"
            class="ob-label-tooltip"
            title="The name of the service or company ‚Äî e.g. Gmail, Chase Bank, Netflix. Use the brand name your family would recognise.">
            Provider <span class="req" aria-hidden="true">*</span>
            <span class="ob-tip" role="tooltip">The name of the service or company ‚Äî e.g. Gmail, Chase Bank, Netflix. Use the brand name your family would recognise.</span>
          </label>
          {{ form.account_name_or_provider }}
          <span class="ob-hint">e.g. Gmail, Chase Bank, Netflix</span>
          {% if form.account_name_or_provider.errors %}
          <ul class="errorlist" role="alert">{% for e in form.account_name_or_provider.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Category #}
        <div class="ob-field{% if form.account_category.errors %} has-error{% endif %}">
          <label
            for="{{ form.account_category.id_for_label }}"
            class="ob-label-tooltip"
            title="Choose the type that best describes this account. This helps your family quickly find and sort accounts by purpose.">
            Category <span class="req" aria-hidden="true">*</span>
            <span class="ob-tip" role="tooltip">Choose the type that best describes this account. This helps your family quickly find and sort accounts by purpose.</span>
          </label>
          {{ form.account_category }}
          {% if form.account_category.errors %}
          <ul class="errorlist" role="alert">{% for e in form.account_category.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Assign to Contact #}
        <div class="ob-field{% if form.delegated_account_to.errors %} has-error{% endif %}">
          <label
            for="{{ form.delegated_account_to.id_for_label }}"
            class="ob-label-tooltip"
            title="Select the trusted contact who should be responsible for managing or closing this account. Contacts are added in Step 1.">
            Assign to Contact <span class="req" aria-hidden="true">*</span>
            <span class="ob-tip" role="tooltip">Select the trusted contact responsible for managing or closing this account. Contacts are added in Step 1.</span>
          </label>
          {{ form.delegated_account_to }}
          <span class="ob-hint">Who should handle this account?</span>
          {% if form.delegated_account_to.errors %}
          <ul class="errorlist" role="alert">{% for e in form.delegated_account_to.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Instruction #}
        <div class="ob-field{% if form.keep_or_close_instruction.errors %} has-error{% endif %}">
          <label
            for="{{ form.keep_or_close_instruction.id_for_label }}"
            class="ob-label-tooltip"
            title="Tell your family what to do with this account ‚Äî keep it active, close it, or something else like transferring ownership.">
            Instruction <span class="req" aria-hidden="true">*</span>
            <span class="ob-tip" role="tooltip">Tell your family what to do with this account ‚Äî keep it active, close it, or transfer ownership.</span>
          </label>
          {{ form.keep_or_close_instruction }}
          {% if form.keep_or_close_instruction.errors %}
          <ul class="errorlist" role="alert">{% for e in form.keep_or_close_instruction.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Username / Login Email #}
        <div class="ob-field{% if form.username_or_email.errors %} has-error{% endif %}">
          <label
            for="{{ form.username_or_email.id_for_label }}"
            class="ob-label-tooltip"
            title="The email address or username used to log in. Never enter a password here ‚Äî this is just an identifier so your family can locate the account.">
            Username / Login Email
            <span class="ob-tip" role="tooltip">The email or username used to log in. Never enter a password ‚Äî just the identifier your family needs to locate the account.</span>
          </label>
          {{ form.username_or_email }}
          <span class="ob-hint">No passwords ‚Äî just the login identifier</span>
          {% if form.username_or_email.errors %}
          <ul class="errorlist" role="alert">{% for e in form.username_or_email.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Website URL #}
        <div class="ob-field{% if form.website_url.errors %} has-error{% endif %}">
          <label
            for="{{ form.website_url.id_for_label }}"
            class="ob-label-tooltip"
            title="The direct web address for this account's login page ‚Äî e.g. https://mail.google.com. Helps your family navigate straight to the right place.">
            Website URL
            <span class="ob-tip" role="tooltip">The direct login page URL ‚Äî e.g. https://mail.google.com. Helps your family navigate straight to the right place.</span>
          </label>
          {{ form.website_url }}
          {% if form.website_url.errors %}
          <ul class="errorlist" role="alert">{% for e in form.website_url.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Password Storage Location #}
        <div class="ob-field ob-full{% if form.credential_storage_location.errors %} has-error{% endif %}">
          <label
            for="{{ form.credential_storage_location.id_for_label }}"
            class="ob-label-tooltip"
            title="Describe where the password for this account is stored ‚Äî not the password itself. For example: '1Password ‚Äì Work Logins folder' or 'Sticky note taped inside office drawer'.">
            Password Storage Location
            <span class="ob-tip" role="tooltip">Where is the password stored ‚Äî not the password itself. e.g. "1Password ‚Äì Work Logins folder" or "Sticky note inside office drawer".</span>
          </label>
          {{ form.credential_storage_location }}
          <span class="ob-hint">e.g. "1Password - Work Logins folder", "Sticky note in office drawer"</span>
          {% if form.credential_storage_location.errors %}
          <ul class="errorlist" role="alert">{% for e in form.credential_storage_location.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Notes for Family #}
        <div class="ob-field ob-full{% if form.notes_for_family.errors %} has-error{% endif %}">
          <label
            for="{{ form.notes_for_family.id_for_label }}"
            class="ob-label-tooltip"
            title="Any extra context your family might need ‚Äî such as subscription billing dates, linked accounts, recurring payments, or special cancellation steps.">
            Notes for Family
            <span class="ob-tip" role="tooltip">Extra context your family may need ‚Äî billing dates, linked accounts, recurring payments, or special cancellation steps.</span>
          </label>
          {{ form.notes_for_family }}
          <span class="ob-hint">Any special instructions about this account</span>
          {% if form.notes_for_family.errors %}
          <ul class="errorlist" role="alert">{% for e in form.notes_for_family.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Review Schedule #}
        <div class="ob-field{% if form.review_time.errors %} has-error{% endif %}">
          <label
            for="{{ form.review_time.id_for_label }}"
            class="ob-label-tooltip"
            title="How often you want to be reminded to check that this account's details are still accurate ‚Äî monthly, quarterly, or annually.">
            Review Schedule
            <span class="ob-tip" role="tooltip">How often you want to be reminded to verify this account's details are still accurate ‚Äî monthly, quarterly, or annually.</span>
          </label>
          {{ form.review_time }}
          <span class="ob-hint">How often should this be reviewed?</span>
          {% if form.review_time.errors %}
          <ul class="errorlist" role="alert">{% for e in form.review_time.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

      </div>{# /ob-grid #}

      <div class="ob-actions">
        <a href="{% url 'dashboard:onboarding_contacts' %}" class="ob-btn ob-btn-ghost">
          <i class="fas fa-arrow-left"></i> Back
        </a>
        <button type="submit" class="ob-btn ob-btn-primary">
          <i class="fas fa-plus"></i> Add Account
        </button>
        <div class="ob-spacer"></div>
        <a href="{% url 'dashboard:onboarding_devices' %}" class="ob-btn ob-btn-accent">
          Continue to Devices <i class="fas fa-arrow-right"></i>
        </a>
      </div>
    </div>
  </form>

  <!-- ‚îÄ‚îÄ PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="ob-panel">
    <div class="ob-panel-card">
      <div class="ob-panel-label">Added Accounts ({{ accounts.count }})</div>

      {% if accounts %}
      <div class="ob-items">
        {% for account in accounts %}
        <div class="ob-item">
          <div class="ob-item-icon">
            {% if 'Email' in account.account_category %}üìß
            {% elif 'Bank' in account.account_category or 'Brokerage' in account.account_category %}üè¶
            {% elif 'Social' in account.account_category %}üí¨
            {% elif 'Stream' in account.account_category %}üé¨
            {% elif 'Crypto' in account.account_category %}‚Çø
            {% elif 'Gaming' in account.account_category %}üéÆ
            {% elif 'Password' in account.account_category %}üîë
            {% else %}üîê{% endif %}
          </div>
          <div class="ob-item-body">
            <div class="ob-item-name">{{ account.account_name_or_provider }}</div>
            <div class="ob-item-sub">{{ account.get_account_category_display }}</div>
          </div>
          <span class="ob-badge {% if account.keep_or_close_instruction == 'Close Account' %}badge-navy{% elif account.keep_or_close_instruction == 'Keep Active' %}badge-blue{% else %}badge-amber{% endif %}">
            {% if account.keep_or_close_instruction == 'Close Account' %}Close
            {% elif account.keep_or_close_instruction == 'Keep Active' %}Keep
            {% else %}Other{% endif %}
          </span>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="ob-empty">
        <div class="ob-empty-icon"><i class="fas fa-lock"></i></div>
        <p>No accounts yet.<br>Add your first account above.</p>
      </div>
      {% endif %}
    </div>

    <a href="{% url 'dashboard:onboarding_devices' %}" class="ob-btn ob-btn-blue ob-btn-full">
      Continue ‚Üí Devices <i class="fas fa-arrow-right"></i>
    </a>

    <!-- ‚îÄ‚îÄ PANEL (ERRORS) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    {% if form.errors or form.non_field_errors %}
    <div class="ob-panel-card">
      <div class="ob-panel-label">
        {% if form.errors %}
        <div class="ob-error-summary" role="alert" aria-live="polite">
          <div class="ob-error-summary-title">
            <i class="fas fa-exclamation-triangle"></i>
            <p>Please fix the following before saving:</p>
          </div>
          <ul class="ob-error-summary-list">
            {% for field in form %}
              {% if field.errors %}
                {% for error in field.errors %}
                <li>{{ field.label }}</li>
                {% endfor %}
              {% endif %}
            {% endfor %}
            {% for error in form.non_field_errors %}
            <li>{{ error }}</li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </div>
    </div>
    {% endif %}
    {# end ob-panel errors #}

  </div>{# end ob-panel #}
</div>{# end ob-body #}

{% endblock %}