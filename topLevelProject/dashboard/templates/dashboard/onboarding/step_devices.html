{% extends "dashboard/onboarding/base_onboarding.html" %}
{% block title %}Step 3 ‚Äî Add Your Devices{% endblock %}

{% block ob_content %}
<div class="ob-page-header">
  <div class="ob-eyebrow">Step 3 of 6</div>
  <h1>Your physical devices.</h1>
  <p>Record the phones, laptops, and tablets your family should know about ‚Äî where they're kept and what to do with each one.</p>
</div>

<div class="ob-body">

  <!-- ‚îÄ‚îÄ FORM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <form method="post" novalidate>
    {% csrf_token %}
    <div class="ob-form-card">
      <div class="ob-card-heading">
        <div class="ob-card-icon"><i class="fas fa-laptop"></i></div>
        Add a Device
      </div>

      <div class="ob-grid">

        {# Device Name #}
        <div class="ob-field{% if form.device_name.errors %} has-error{% endif %}">
          <label for="{{ form.device_name.id_for_label }}"
            class="ob-label-tooltip"
            title="The brand, model, and year of the device ‚Äî specific enough that your family can identify it. e.g. iPhone 15 Pro, MacBook Pro 2022.">
            Device Name / Model <span class="req" aria-hidden="true">*</span>
            <span class="ob-tip" role="tooltip">Brand, model, and year ‚Äî specific enough for your family to identify it. e.g. iPhone 15 Pro, MacBook Pro 2022.</span>
          </label>
          {{ form.device_name }}
          <span class="ob-hint">e.g. iPhone 15 Pro, MacBook Pro 2022</span>
          {% if form.device_name.errors %}
          <ul class="errorlist" role="alert">{% for e in form.device_name.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Device Type #}
        <div class="ob-field{% if form.device_type.errors %} has-error{% endif %}">
          <label for="{{ form.device_type.id_for_label }}"
            class="ob-label-tooltip"
            title="The general category of this device ‚Äî Phone, Laptop, Desktop, Tablet, Smart Watch, or Other. Used to group and display devices for your family.">
            Device Type <span class="req" aria-hidden="true">*</span>
            <span class="ob-tip" role="tooltip">General category ‚Äî Phone, Laptop, Desktop, Tablet, Smart Watch, or Other. Used to group devices for your family.</span>
          </label>
          {{ form.device_type }}
          {% if form.device_type.errors %}
          <ul class="errorlist" role="alert">{% for e in form.device_type.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Assign to Contact #}
        <div class="ob-field{% if form.delegated_device_to.errors %} has-error{% endif %}">
          <label for="{{ form.delegated_device_to.id_for_label }}"
            class="ob-label-tooltip"
            title="The trusted contact who should take responsibility for this device ‚Äî wiping it, transferring data, or following your decommission instructions.">
            Assign to Contact <span class="req" aria-hidden="true">*</span>
            <span class="ob-tip" role="tooltip">The trusted contact who should take responsibility for this device ‚Äî wiping, transferring data, or following your decommission instructions.</span>
          </label>
          {{ form.delegated_device_to }}
          <span class="ob-hint">Who should handle this device?</span>
          {% if form.delegated_device_to.errors %}
          <ul class="errorlist" role="alert">{% for e in form.delegated_device_to.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Label #}
        <div class="ob-field{% if form.owner_label.errors %} has-error{% endif %}">
          <label for="{{ form.owner_label.id_for_label }}"
            class="ob-label-tooltip"
            title="A short nickname your family will immediately recognise ‚Äî e.g. 'Mom's iPhone' or 'Work Laptop'. Shown as a badge on the device list.">
            Label
            <span class="ob-tip" role="tooltip">A short nickname your family will recognise ‚Äî e.g. "Mom's iPhone" or "Work Laptop". Shown as a badge on the device list.</span>
          </label>
          {{ form.owner_label }}
          <span class="ob-hint">e.g. "Mom's iPhone", "Work Laptop"</span>
          {% if form.owner_label.errors %}
          <ul class="errorlist" role="alert">{% for e in form.owner_label.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Location #}
        <div class="ob-field ob-full{% if form.location_description.errors %} has-error{% endif %}">
          <label for="{{ form.location_description.id_for_label }}"
            class="ob-label-tooltip"
            title="Where this device is physically stored so your family can locate it. Be as specific as possible ‚Äî e.g. 'Bedroom nightstand drawer' or 'Home office desk'.">
            Where is it kept?
            <span class="ob-tip" role="tooltip">Where this device is physically stored. Be specific ‚Äî e.g. "Bedroom nightstand drawer" or "Home office desk".</span>
          </label>
          {{ form.location_description }}
          <span class="ob-hint">e.g. "Bedroom nightstand drawer", "Home office desk"</span>
          {% if form.location_description.errors %}
          <ul class="errorlist" role="alert">{% for e in form.location_description.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Unlock Method #}
        <div class="ob-field ob-full{% if form.unlock_method_description.errors %} has-error{% endif %}">
          <label for="{{ form.unlock_method_description.id_for_label }}"
            class="ob-label-tooltip"
            title="Describe how to gain access to this device without recording the actual PIN or password. Point your family to where the credentials are stored instead.">
            How to Unlock
            <span class="ob-tip" role="tooltip">Describe access without recording the actual PIN or password. Point your family to where credentials are stored ‚Äî e.g. "6-digit PIN stored in 1Password".</span>
          </label>
          {{ form.unlock_method_description }}
          <span class="ob-hint">Don't include actual PINs ‚Äî describe where to find them, e.g. "6-digit PIN stored in 1Password"</span>
          {% if form.unlock_method_description.errors %}
          <ul class="errorlist" role="alert">{% for e in form.unlock_method_description.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Decommission #}
        <div class="ob-field ob-full{% if form.decommission_instruction.errors %} has-error{% endif %}">
          <label for="{{ form.decommission_instruction.id_for_label }}"
            class="ob-label-tooltip"
            title="Tell your family exactly what to do with this device ‚Äî wipe and give away, donate, recycle, keep, or sell. Be specific so there's no guesswork.">
            What to Do With This Device
            <span class="ob-tip" role="tooltip">Tell your family exactly what to do ‚Äî wipe and give away, donate, recycle, keep, or sell. Be specific so there's no guesswork.</span>
          </label>
          {{ form.decommission_instruction }}
          <span class="ob-hint">e.g. "Wipe and give to daughter", "Factory reset and donate to charity"</span>
          {% if form.decommission_instruction.errors %}
          <ul class="errorlist" role="alert">{% for e in form.decommission_instruction.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Review Schedule #}
        <div class="ob-field{% if form.review_time.errors %} has-error{% endif %}">
          <label for="{{ form.review_time.id_for_label }}"
            class="ob-label-tooltip"
            title="How often you want a reminder to check that this device's details ‚Äî location, unlock method, and instructions ‚Äî are still accurate.">
            Review Schedule
            <span class="ob-tip" role="tooltip">How often you want a reminder to verify this device's details ‚Äî location, unlock method, and instructions ‚Äî are still accurate.</span>
          </label>
          {{ form.review_time }}
          {% if form.review_time.errors %}
          <ul class="errorlist" role="alert">{% for e in form.review_time.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

      </div>{# /ob-grid #}

      {# 2FA checkbox #}
      <div style="margin-top: 1.1rem;">
        <label class="ob-check-row" style="max-width: 380px;">
          {{ form.used_for_2fa }}
          <div>
            <div class="ob-check-label">
              <i class="fas fa-key" style="color: var(--accent-color); margin-right: 6px;"></i>
              Used for Two-Factor Authentication (2FA)
            </div>
            <div style="font-family: var(--paragraph-font); font-size: var(--font-sm); font-weight: 300; color: var(--thirty-percent); margin-top: 2px;">
              This device receives login verification codes
            </div>
          </div>
        </label>
        {% if form.used_for_2fa.errors %}
        <ul class="errorlist" role="alert">{% for e in form.used_for_2fa.errors %}<li>{{ e }}</li>{% endfor %}</ul>
        {% endif %}
      </div>

      <div class="ob-actions">
        <a href="{% url 'dashboard:onboarding_accounts' %}" class="ob-btn ob-btn-ghost">
          <i class="fas fa-arrow-left"></i> Back
        </a>
        <button type="submit" class="ob-btn ob-btn-primary">
          <i class="fas fa-plus"></i> Add Device
        </button>
        <div class="ob-spacer"></div>
        <a href="{% url 'dashboard:onboarding_estate' %}" class="ob-btn ob-btn-accent">
          Continue to Step 4 <i class="fas fa-arrow-right"></i>
        </a>
      </div>
    </div>
  </form>

  <!-- ‚îÄ‚îÄ PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="ob-panel">
    <div class="ob-panel-card">
      <div class="ob-panel-label">Added Devices ({{ devices.count }})</div>

      {% if devices %}
      <div class="ob-items">
        {% for device in devices %}
        <div class="ob-item">
          <div class="ob-item-icon">
            {% if device.device_type == 'Phone' %}üì±
            {% elif device.device_type == 'Laptop' %}üíª
            {% elif device.device_type == 'Desktop' %}üñ•Ô∏è
            {% elif device.device_type == 'Tablet' %}üì≤
            {% elif device.device_type == 'Smart Watch' %}‚åö
            {% else %}üì¶{% endif %}
          </div>
          <div class="ob-item-body">
            <div class="ob-item-name">{{ device.device_name }}</div>
            <div class="ob-item-sub">
              {{ device.device_type }}
              {% if device.used_for_2fa %}<span style="color: var(--accent-color);"> ¬∑ üîë 2FA</span>{% endif %}
            </div>
          </div>
          {% if device.owner_label %}
          <span class="ob-badge badge-blue">{{ device.owner_label|truncatechars:12 }}</span>
          {% endif %}
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="ob-empty">
        <div class="ob-empty-icon"><i class="fas fa-laptop"></i></div>
        <p>No devices yet.<br>Add your first device above.</p>
      </div>
      {% endif %}
    </div>

    <div class="ob-tip">
      <div class="ob-tip-title"><i class="fas fa-lightbulb"></i> Don't forget</div>
      <ul>
        <li><i class="fas fa-check" style="color: var(--sixty-percent); margin-right: 7px; width: 12px;"></i>Your primary phone</li>
        <li><i class="fas fa-check" style="color: var(--sixty-percent); margin-right: 7px; width: 12px;"></i>Home or work computer</li>
        <li><i class="fas fa-check" style="color: var(--sixty-percent); margin-right: 7px; width: 12px;"></i>Tablet or iPad</li>
        <li><i class="fas fa-check" style="color: var(--sixty-percent); margin-right: 7px; width: 12px;"></i>Smartwatch (especially if used for payments)</li>
        <li><i class="fas fa-check" style="color: var(--sixty-percent); margin-right: 7px; width: 12px;"></i>Any device used to receive 2FA codes</li>
      </ul>
    </div>

    <a href="{% url 'dashboard:onboarding_estate' %}" class="ob-btn ob-btn-blue ob-btn-full">
      Continue ‚Üí Estate Docs <i class="fas fa-arrow-right"></i>
    </a>

    <!-- ‚îÄ‚îÄ PANEL (ERRORS) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    {% if form.errors or form.non_field_errors %}
    <div class="ob-panel-card">
      <div class="ob-panel-label">
        {% if form.errors %}
        <div class="ob-error-summary" role="alert" aria-live="polite">
          <div class="ob-error-summary-title">
            <i class="fas fa-exclamation-triangle"></i>
            <p>Please fix the following before saving:</p>
          </div>
          <ul class="ob-error-summary-list">
            {% for field in form %}
              {% if field.errors %}
                {% for error in field.errors %}
                <li>{{ field.label }}</li>
                {% endfor %}
              {% endif %}
            {% endfor %}
            {% for error in form.non_field_errors %}
            <li>{{ error }}</li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </div>
    </div>
    {% endif %}
    {# end ob-panel errors #}

  </div>{# end ob-panel #}

</div>{# end ob-body #}

{% endblock %}