{% extends "dashboard/onboarding/base_onboarding.html" %}
{% block title %}Step 5 ‚Äî Add Important Documents{% endblock %}

{% block ob_content %}
<div class="ob-page-header">
  <div class="ob-eyebrow">Step 5 of 6</div>
  <h1>Your important documents.</h1>
  <p>Catalog the financial, medical, and personal records your family will need to locate ‚Äî insurance policies, bank details, property deeds, identification, and more.</p>
</div>

<div class="ob-body">

  <!-- ‚îÄ‚îÄ FORM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <form method="post" novalidate>
    {% csrf_token %}
    <div class="ob-form-card">
      <div class="ob-card-heading">
        <div class="ob-card-icon"><i class="fas fa-folder-open"></i></div>
        Add an Important Document
      </div>

      <div class="ob-grid">

        {# Document Name #}
        <div class="ob-field ob-full{% if form.name_or_title.errors %} has-error{% endif %}">
          <label for="{{ form.name_or_title.id_for_label }}"
            class="ob-label-tooltip"
            title="A clear, descriptive name for this document so your family can immediately understand what it is and why it matters.">
            Document Name <span class="req" aria-hidden="true">*</span>
            <span class="ob-tip" role="tooltip">A clear, descriptive name so your family can immediately understand what it is. e.g. "Term Life Insurance Policy" or "Vehicle Title ‚Äî 2021 Honda CRV".</span>
          </label>
          {{ form.name_or_title }}
          <span class="ob-hint">e.g. "Term Life Insurance Policy", "Vehicle Title ‚Äî 2021 Honda CRV"</span>
          {% if form.name_or_title.errors %}
          <ul class="errorlist" role="alert">{% for e in form.name_or_title.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Category #}
        <div class="ob-field{% if form.document_category.errors %} has-error{% endif %}">
          <label for="{{ form.document_category.id_for_label }}"
            class="ob-label-tooltip"
            title="The type of document ‚Äî e.g. Insurance, Financial, Medical, Property, Identification. Helps your family filter and find the right records quickly.">
            Category <span class="req" aria-hidden="true">*</span>
            <span class="ob-tip" role="tooltip">The document type ‚Äî Insurance, Financial, Medical, Property, Identification, etc. Helps your family filter and find the right records quickly.</span>
          </label>
          {{ form.document_category }}
          {% if form.document_category.errors %}
          <ul class="errorlist" role="alert">{% for e in form.document_category.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Assign to Contact #}
        <div class="ob-field{% if form.delegated_important_document_to.errors %} has-error{% endif %}">
          <label for="{{ form.delegated_important_document_to.id_for_label }}"
            class="ob-label-tooltip"
            title="The contact who should be the first to access, act on, or safeguard this document ‚Äî e.g. your executor for financial records, or your healthcare proxy for medical documents.">
            Assign to Contact <span class="req" aria-hidden="true">*</span>
            <span class="ob-tip" role="tooltip">The first person who should access or act on this document ‚Äî e.g. your executor for financial records, or healthcare proxy for medical ones.</span>
          </label>
          {{ form.delegated_important_document_to }}
          <span class="ob-hint">Who should access this document?</span>
          {% if form.delegated_important_document_to.errors %}
          <ul class="errorlist" role="alert">{% for e in form.delegated_important_document_to.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Description #}
        <div class="ob-field{% if form.description.errors %} has-error{% endif %}">
          <label for="{{ form.description.id_for_label }}"
            class="ob-label-tooltip"
            title="A brief summary of what this document covers ‚Äî policy numbers, account details, coverage amounts, or any other key facts your family would need to know immediately.">
            Description
            <span class="ob-tip" role="tooltip">A brief summary of what this document covers ‚Äî policy numbers, coverage amounts, account details, or other key facts your family needs to know immediately.</span>
          </label>
          {{ form.description }}
          <span class="ob-hint">Brief note about what this document covers</span>
          {% if form.description.errors %}
          <ul class="errorlist" role="alert">{% for e in form.description.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Physical Location #}
        <div class="ob-field{% if form.physical_location.errors %} has-error{% endif %}">
          <label for="{{ form.physical_location.id_for_label }}"
            class="ob-label-tooltip"
            title="Where the original physical copy of this document is stored ‚Äî be specific enough that your family can find it without you. e.g. 'Fireproof safe in master bedroom closet'.">
            Physical Location
            <span class="ob-tip" role="tooltip">Where the original copy is stored. Be specific enough that your family can find it without you ‚Äî e.g. "Fireproof safe in master bedroom closet".</span>
          </label>
          {{ form.physical_location }}
          <span class="ob-hint">e.g. "Fireproof safe in master bedroom closet"</span>
          {% if form.physical_location.errors %}
          <ul class="errorlist" role="alert">{% for e in form.physical_location.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Digital Location #}
        <div class="ob-field{% if form.digital_location.errors %} has-error{% endif %}">
          <label for="{{ form.digital_location.id_for_label }}"
            class="ob-label-tooltip"
            title="Where a digital copy or scan of this document is stored ‚Äî allows your family to access it quickly before locating the physical original.">
            Digital Location
            <span class="ob-tip" role="tooltip">Where a digital copy or scan is stored for quick access ‚Äî e.g. "Dropbox / Important Docs folder" or "Google Drive / Insurance".</span>
          </label>
          {{ form.digital_location }}
          <span class="ob-hint">e.g. "Dropbox / Important Docs folder"</span>
          {% if form.digital_location.errors %}
          <ul class="errorlist" role="alert">{% for e in form.digital_location.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

        {# Review Schedule #}
        <div class="ob-field{% if form.review_time.errors %} has-error{% endif %}">
          <label for="{{ form.review_time.id_for_label }}"
            class="ob-label-tooltip"
            title="How often you want a reminder to check that this document is still current ‚Äî important for insurance policies, tax records, and anything with expiry dates.">
            Review Schedule
            <span class="ob-tip" role="tooltip">How often you want a reminder to check this document is still current ‚Äî especially important for insurance policies and records with expiry dates.</span>
          </label>
          {{ form.review_time }}
          {% if form.review_time.errors %}
          <ul class="errorlist" role="alert">{% for e in form.review_time.errors %}<li>{{ e }}</li>{% endfor %}</ul>
          {% endif %}
        </div>

      </div>{# /ob-grid #}

      {# When this document applies ‚Äî requires at least one #}
      <div style="margin-top: 1.2rem;">
        <div class="ob-field{% if form.non_field_errors %} has-error{% endif %}">
          <label>
            When does this apply?
            <span style="font-weight: 300; font-size: var(--font-sm); color: var(--thirty-percent);">(select at least one)</span>
          </label>
        </div>

        {% if form.non_field_errors %}
        <ul class="errorlist" role="alert" style="margin-bottom: 0.75rem;">
          {% for error in form.non_field_errors %}<li>{{ error }}</li>{% endfor %}
        </ul>
        {% endif %}

        <div class="ob-check-group" style="margin-top: 0.5rem;">
          <label class="ob-check-row">
            {{ form.applies_on_death }}
            <span class="ob-check-label"><i class="fas fa-moon" style="color: var(--ten-percent); margin-right: 5px;"></i>On Death</span>
          </label>
          <label class="ob-check-row">
            {{ form.applies_on_incapacity }}
            <span class="ob-check-label"><i class="fas fa-hospital" style="color: var(--thirty-percent); margin-right: 5px;"></i>On Incapacity</span>
          </label>
          <label class="ob-check-row">
            {{ form.requires_legal_review }}
            <span class="ob-check-label"><i class="fas fa-gavel" style="color: var(--accent-color); margin-right: 5px;"></i>Legal Review Needed</span>
          </label>
        </div>
        {% if form.applies_on_death.errors %}<ul class="errorlist" role="alert">{% for e in form.applies_on_death.errors %}<li>{{ e }}</li>{% endfor %}</ul>{% endif %}
        {% if form.applies_on_incapacity.errors %}<ul class="errorlist" role="alert">{% for e in form.applies_on_incapacity.errors %}<li>{{ e }}</li>{% endfor %}</ul>{% endif %}
        {% if form.requires_legal_review.errors %}<ul class="errorlist" role="alert">{% for e in form.requires_legal_review.errors %}<li>{{ e }}</li>{% endfor %}</ul>{% endif %}
      </div>

      <div class="ob-actions">
        <a href="{% url 'dashboard:onboarding_estate' %}" class="ob-btn ob-btn-ghost">
          <i class="fas fa-arrow-left"></i> Back
        </a>
        <button type="submit" class="ob-btn ob-btn-primary">
          <i class="fas fa-plus"></i> Add Document
        </button>
        <div class="ob-spacer"></div>
        <a href="{% url 'dashboard:onboarding_family' %}" class="ob-btn ob-btn-accent">
          Continue to Step 6 <i class="fas fa-arrow-right"></i>
        </a>
      </div>
    </div>
  </form>

  <!-- ‚îÄ‚îÄ PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="ob-panel">
    <div class="ob-panel-card">
      <div class="ob-panel-label">Added Documents ({{ documents.count }})</div>

      {% if documents %}
      <div class="ob-items">
        {% for doc in documents %}
        <div class="ob-item" style="border-left-color: var(--thirty-percent);">
          <div class="ob-item-icon" style="background: rgba(45,106,156,0.1);">
            {% if 'Insurance' in doc.document_category %}üõ°Ô∏è
            {% elif 'Tax' in doc.document_category or 'Financial' in doc.document_category %}üí∞
            {% elif 'Medical' in doc.document_category or 'Health' in doc.document_category %}üè•
            {% elif 'Property' in doc.document_category or 'Deed' in doc.document_category %}üè†
            {% elif 'Social Security' in doc.document_category or 'Identification' in doc.document_category %}ü™™
            {% elif 'Bank' in doc.document_category %}üè¶
            {% else %}üìÇ{% endif %}
          </div>
          <div class="ob-item-body">
            <div class="ob-item-name">{{ doc.name_or_title }}</div>
            <div class="ob-item-sub">{{ doc.document_category|truncatechars:32 }}</div>
          </div>
          {% if doc.requires_legal_review %}
          <span class="ob-badge badge-amber">Legal</span>
          {% endif %}
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="ob-empty">
        <div class="ob-empty-icon"><i class="fas fa-folder-open"></i></div>
        <p>No documents yet.<br>Add your first important document above.</p>
      </div>
      {% endif %}
    </div>

    <div class="ob-tip">
      <div class="ob-tip-title"><i class="fas fa-lightbulb"></i> Common documents to add</div>
      <ul>
        <li><i class="fas fa-check" style="color: var(--sixty-percent); margin-right: 7px; width: 12px;"></i>Life insurance policy</li>
        <li><i class="fas fa-check" style="color: var(--sixty-percent); margin-right: 7px; width: 12px;"></i>Bank &amp; investment accounts</li>
        <li><i class="fas fa-check" style="color: var(--sixty-percent); margin-right: 7px; width: 12px;"></i>Property deeds &amp; vehicle titles</li>
        <li><i class="fas fa-check" style="color: var(--sixty-percent); margin-right: 7px; width: 12px;"></i>Passport &amp; Social Security card</li>
        <li><i class="fas fa-check" style="color: var(--sixty-percent); margin-right: 7px; width: 12px;"></i>Tax returns (last 3 years)</li>
        <li><i class="fas fa-check" style="color: var(--sixty-percent); margin-right: 7px; width: 12px;"></i>Medical records &amp; prescriptions</li>
      </ul>
    </div>

    <a href="{% url 'dashboard:onboarding_family' %}" class="ob-btn ob-btn-blue ob-btn-full">
      Continue ‚Üí Family Notes <i class="fas fa-arrow-right"></i>
    </a>

    <!-- ‚îÄ‚îÄ PANEL (ERRORS) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    {% if form.errors or form.non_field_errors %}
    <div class="ob-panel-card">
      <div class="ob-panel-label">
        {% if form.errors %}
        <div class="ob-error-summary" role="alert" aria-live="polite">
          <div class="ob-error-summary-title">
            <i class="fas fa-exclamation-triangle"></i>
            <p>Please fix the following before saving:</p>
          </div>
          <ul class="ob-error-summary-list">
            {% for field in form %}
              {% if field.errors %}
                {% for error in field.errors %}
                <li>{{ field.label }}</li>
                {% endfor %}
              {% endif %}
            {% endfor %}
            {% for error in form.non_field_errors %}
            <li>{{ error }}</li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </div>
    </div>
    {% endif %}
    {# end ob-panel errors #}

  </div>{# end ob-panel #}
</div>{# end ob-body #}

{% endblock %}