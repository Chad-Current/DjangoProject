{% extends "dashboard/dashboard.html" %}
{% load static %}

{% block title %}Delete Contact{% endblock %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'dashboard/css/delete.css' %}" type="text/css">
{% endblock %}

{% block content %}
<div class="main">
    <div class="delete-view-wrapper">
        <div class="delete-view">

            {% if has_assignments %}

                <!-- Warning icon -->
                <div class="delete-icon">
                    <i class="fas fa-user-lock" style="color: #dc2626;"></i>
                </div>

                <!-- Heading -->
                <h2 class="delete-title">Cannot Delete Contact</h2>
                <p class="delete-subtitle">This contact has assigned items that must be reassigned first</p>

                <!-- Item name chip -->
                <div class="delete-item-name">
                    <i class="fas fa-user"></i>
                    {{ contact.first_name }} {{ contact.last_name }}
                </div>

                <!-- Warning notice -->
                <div class="delete-warning-notice">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>
                        <strong>{{ total_assignments }} item(s)</strong> are currently assigned to this contact.
                        Please reassign them to another contact before deleting.
                    </p>
                </div>

                <!-- Assigned items -->
                {% if estate_documents %}
                <div class="delete-assignment-group">
                    <p class="delete-assignment-label">Estate Documents ({{ estate_documents.count }})</p>
                    <ul class="delete-assignment-list">
                        {% for doc in estate_documents %}
                        <li class="delete-assignment-item">
                            <span><i class="fas fa-file-contract"></i>{{ doc.name_or_title }}</span>
                            <a href="{% url 'dashboard:estate_update' doc.slug %}" class="delete-reassign-link">Reassign →</a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if important_documents %}
                <div class="delete-assignment-group">
                    <p class="delete-assignment-label">Important Documents ({{ important_documents.count }})</p>
                    <ul class="delete-assignment-list">
                        {% for doc in important_documents %}
                        <li class="delete-assignment-item">
                            <span><i class="fas fa-file-alt"></i>{{ doc.name_or_title }}</span>
                            <a href="{% url 'dashboard:importantdocument_update' doc.slug %}" class="delete-reassign-link">Reassign →</a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if assigned_accounts %}
                <div class="delete-assignment-group">
                    <p class="delete-assignment-label">Accounts ({{ assigned_accounts.count }})</p>
                    <ul class="delete-assignment-list">
                        {% for assign in assigned_accounts %}
                        <li class="delete-assignment-item">
                            <span><i class="fas fa-globe"></i>{{ assign.account_name_or_provider }}</span>
                            <a href="{% url 'dashboard:account_update' assign.slug %}" class="delete-reassign-link">Reassign →</a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if assigned_devices %}
                <div class="delete-assignment-group">
                    <p class="delete-assignment-label">Devices ({{ assigned_devices.count }})</p>
                    <ul class="delete-assignment-list">
                        {% for device in assigned_devices %}
                        <li class="delete-assignment-item">
                            <span><i class="fas fa-laptop"></i>{{ device.device_name }}</span>
                            <a href="{% url 'dashboard:device_update' device.slug %}" class="delete-reassign-link">Reassign →</a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if not has_other_contacts %}
                <div class="delete-warning-notice">
                    <i class="fas fa-users-slash"></i>
                    <p><strong>No other contacts available.</strong> You'll need to create a new contact before you can reassign these items.</p>
                </div>
                {% endif %}

                <!-- Action buttons -->
                <div class="delete-actions">
                    <a href="{% url 'dashboard:contact_list' %}" class="btn-cancel">
                        <i class="fas fa-arrow-left"></i> Back to Contacts
                    </a>
                    {% if not has_other_contacts %}
                    <a href="{% url 'dashboard:contact_create' %}" class="btn-confirm-delete btn-confirm-create">
                        <i class="fas fa-user-plus"></i> Create New Contact
                    </a>
                    {% endif %}
                </div>

            {% else %}

                <!-- Warning icon -->
                <div class="delete-icon">
                    <i class="fas fa-trash-alt" style="color: #dc2626;"></i>
                </div>

                <!-- Heading -->
                <h2 class="delete-title">Delete Contact?</h2>
                <p class="delete-subtitle">You are about to permanently remove</p>

                <!-- Item name chip -->
                <div class="delete-item-name">
                    <i class="fas fa-user"></i>
                    {{ contact.first_name }} {{ contact.last_name }}
                    <span class="delete-item-meta">— {{ contact.contact_relation }}</span>
                </div>

                <!-- Warning notice -->
                <div class="delete-warning-notice">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>This action cannot be undone. All data associated with this contact will be permanently deleted.</p>
                </div>

                <!-- Action buttons -->
                <div class="delete-actions">
                    <a href="{% url 'dashboard:contact_detail' contact.slug %}" class="btn-cancel">
                        <i class="fas fa-arrow-left"></i> Cancel
                    </a>
                    <form method="post">
                        {% csrf_token %}
                        <button type="submit" class="btn-confirm-delete">
                            <i class="fas fa-trash-alt"></i> Yes, Delete
                        </button>
                    </form>
                </div>

            {% endif %}

        </div>
    </div>
</div>
{% endblock %}