{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Your Digital Vault - Digital Estate Planning</title>
    <link rel="stylesheet" href="{% static 'baseapp/css/stylesheet.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'baseapp/css/index.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'dashboard/css/stylesheet.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'dashboard/css/progress.css' %}" type="text/css">
    <!-- <link rel="stylesheet" href="{% static 'dashboard/css/test.css' %}" type="text/css"> -->
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>

<body>
    {% include "baseapp/navbar.html" %}
    {% include "dashboard/navblocks.html" %}
    
    <div class="vault-dashboard">
        <!-- Hero Section -->
        <div class="vault-hero">
            <h1>
                {% if profile.first_name or profile.last_name %}
                    {{ profile.first_name }} {{ profile.last_name }}'s Digital Vault
                {% else %}
                    Your Digital Vault 
                {% endif %}
            </h1>
            <p class="subtitle">
                {% if progress >= 100 %}
                    ðŸ”’ Fully Secured - Your digital legacy is protected
                {% elif progress >= 70 %}
                    ðŸ” Nearly Complete - Just a few more items to secure
                {% elif progress >= 40 %}
                    ðŸ”“ Building Security - Keep adding to strengthen your vault
                {% else %}
                    ðŸ”“ Getting Started - Begin securing your digital estate
                {% endif %}
            </p>
        </div>

        <!-- Main Vault Container -->
        <div class="vault-container">
            <!-- Left: Progress Circle -->
            <div class="vault-visual">
                <div class="vault-title">
                    <h2>Your Progress</h2>
                    <p class="vault-status">
                        {% if progress >= 100 %}
                            All systems secured
                        {% else %}
                            {{ remaining_tasks }} {% if remaining_tasks == 1 %}category{% else %}categories{% endif %} need attention
                        {% endif %}
                    </p>
                </div>

                <!-- Progress Circle with SVG -->
                <div class="progress-circle-wrapper">
                    <div class="progress-circle-container">
                        <svg class="progress-circle" width="200" height="200" viewBox="0 0 200 200">
                            <circle class="progress-circle-bg" cx="100" cy="100" r="85" fill="none" stroke-width="24"></circle>
                            <circle class="progress-circle-fill" cx="100" cy="100" r="85" fill="none" stroke-width="24" stroke-linecap="round"></circle>
                        </svg>
                        <div class="progress-text">
                            <span class="progress-percentage">0%</span>
                            <span class="progress-label">Complete</span>
                        </div>
                    </div>
                </div>

                <input type="hidden" id="progress-value" value="{{ progress|default:0 }}">
            </div>

            <!-- Right: Protection Layers -->
            <div class="protection-layers">
                <h3><i class="fas fa-shield-alt"></i> Protection Layers</h3>

                <!-- Core Identity Layer -->
                <div class="layer core">
                    <div class="layer-header">
                        <div class="layer-name">
                            <i class="fas fa-user-circle"></i>
                            Core Identity
                        </div>
                        <div class="layer-status">{{ contacts_count }}/5</div>
                    </div>
                    <div class="layer-strength">
                        <div class="layer-strength-fill" style="width: {% if contacts_count %}{% widthratio contacts_count 1 20 %}{% else %}0{% endif %}%"></div>
                    </div>
                    <div class="layer-label">
                        <span>Contacts & Profile</span>
                        <span class="layer-rating {% if contacts_count >= 5 %}excellent{% elif contacts_count >= 3 %}strong{% elif contacts_count >= 1 %}moderate{% else %}weak{% endif %}">
                            {% if contacts_count >= 5 %}EXCELLENT{% elif contacts_count >= 3 %}STRONG{% elif contacts_count >= 1 %}MODERATE{% else %}WEAK{% endif %}
                        </span>
                    </div>
                </div>

                <!-- Digital Accounts Layer -->
                <div class="layer accounts">
                    <div class="layer-header">
                        <div class="layer-name">
                            <i class="fas fa-shield-alt"></i>
                            Digital Accounts
                        </div>
                        <div class="layer-status">{{ accounts_count }}/10</div>
                    </div>
                    <div class="layer-strength">
                        <div class="layer-strength-fill" style="width: {% if accounts_count %}{% widthratio accounts_count 1 10 %}{% else %}0{% endif %}%"></div>
                    </div>
                    <div class="layer-label">
                        <span>Online Accounts & Credentials</span>
                        <span class="layer-rating {% if accounts_count >= 10 %}excellent{% elif accounts_count >= 5 %}strong{% elif accounts_count >= 2 %}moderate{% else %}weak{% endif %}">
                            {% if accounts_count >= 10 %}EXCELLENT{% elif accounts_count >= 5 %}STRONG{% elif accounts_count >= 2 %}MODERATE{% else %}WEAK{% endif %}
                        </span>
                    </div>
                </div>

                <!-- Physical Assets Layer -->
                <div class="layer assets">
                    <div class="layer-header">
                        <div class="layer-name">
                            <i class="fas fa-laptop"></i>
                            Physical Assets
                        </div>
                        <div class="layer-status">{{ devices_count }}/5</div>
                    </div>
                    <div class="layer-strength">
                        <div class="layer-strength-fill" style="width: {% if devices_count %}{% widthratio devices_count 1 20 %}{% else %}0{% endif %}%"></div>
                    </div>
                    <div class="layer-label">
                        <span>Devices & Hardware</span>
                        <span class="layer-rating {% if devices_count >= 5 %}excellent{% elif devices_count >= 3 %}strong{% elif devices_count >= 1 %}moderate{% else %}weak{% endif %}">
                            {% if devices_count >= 5 %}EXCELLENT{% elif devices_count >= 3 %}STRONG{% elif devices_count >= 1 %}MODERATE{% else %}WEAK{% endif %}
                        </span>
                    </div>
                </div>

                <!-- Legacy Documents Layer -->
                <div class="layer legacy">
                    <div class="layer-header">
                        <div class="layer-name">
                            <i class="fas fa-file-contract"></i>
                            Legacy Documents
                        </div>
                        <div class="layer-status">{{ estates_count|add:documents_count }}/8</div>
                    </div>
                    <div class="layer-strength">
                        <div class="layer-strength-fill" style="width: {% with total=estates_count|add:documents_count %}{% if total %}{% widthratio total 1 12.5 %}{% else %}0{% endif %}{% endwith %}%"></div>
                    </div>
                    <div class="layer-label">
                        <span>Estate & Important Documents</span>
                        <span class="layer-rating {% if estates_count|add:documents_count >= 8 %}excellent{% elif estates_count|add:documents_count >= 5 %}strong{% elif estates_count|add:documents_count >= 2 %}moderate{% else %}weak{% endif %}">
                            {% if estates_count|add:documents_count >= 8 %}EXCELLENT{% elif estates_count|add:documents_count >= 5 %}STRONG{% elif estates_count|add:documents_count >= 2 %}MODERATE{% else %}WEAK{% endif %}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Security Log & Upcoming Reviews -->
        <div class="vault-container">
            <div class="security-log">
                <h3><i class="fas fa-clipboard-list"></i> Information Log</h3>
                <div class="log-entries">
                    {% if accounts_count > 0 %}
                    <div class="log-entry">
                        <div class="log-icon success">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="log-content">
                            <div class="log-message">{{ accounts_count }} digital {% if accounts_count == 1 %}account{% else %}accounts{% endif %} secured</div>
                            <div class="log-time">Active protection</div>
                        </div>
                    </div>
                    {% endif %}

                    {% if devices_count > 0 %}
                    <div class="log-entry">
                        <div class="log-icon success">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="log-content">
                            <div class="log-message">{{ devices_count }} {% if devices_count == 1 %}device{% else %}devices{% endif %} registered</div>
                            <div class="log-time">Active protection</div>
                        </div>
                    </div>
                    {% endif %}

                    {% if first_delta %}
                    <div class="log-entry">
                        <div class="log-icon {% if first_delta.days <= 7 %}alert{% elif first_delta.days <= 30 %}warning{% else %}success{% endif %}">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="log-content">
                            <div class="log-message">
                                {% if first_delta.days <= 0 %}
                                    Review overdue - action required
                                {% elif first_delta.days <= 7 %}
                                    Review due in {{ first_delta.days }} {% if first_delta.days == 1 %}day{% else %}days{% endif %}
                                {% else %}
                                    Next review in {{ first_delta.days }} days
                                {% endif %}
                            </div>
                            <div class="log-time">Scheduled maintenance</div>
                        </div>
                    </div>
                    {% endif %}

                    {% if remaining_tasks > 0 %}
                    <div class="log-entry">
                        <div class="log-icon warning">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="log-content">
                            <div class="log-message">
                                {% if remaining_tasks >= 1 and accounts_count == 0 %}
                                    Accounts Need Attention
                                {% elif remaining_tasks >= 1 and care_relations_count == 0 %}    
                                    Care Relation Needs Attention                            
                                {% elif remaining_tasks >= 1 and contacts_count == 0 %}
                                    Contacts Need Attention
                                {% elif remaining_tasks >= 1 and devices_count == 0 %}
                                    Devices Needs Attention
                                {% elif remaining_tasks >= 1 and documents_count == 0 %}
                                    Important Documents Need Attention
                                {% elif remaining_tasks >= 1 and estates_count == 0 %}
                                    Estate Documents Need Attention
                                {% elif remaining_tasks >= 1 and family_knows_count == 0 %}
                                    Family Needs to Know Needs Attention 
                                {% endif %}
                            </div>
                            <div class="log-time">Security recommendation</div>
                        </div>
                    </div>
                    {% endif %}

                    {% if progress >= 100 %}
                    <div class="log-entry">
                        <div class="log-icon success">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="log-content">
                            <div class="log-message">Vault fully secured - all systems operational</div>
                            <div class="log-time">Congratulations!</div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Upcoming Reviews Section -->
            <div class="upcoming-reviews">
                <h3><i class="fas fa-calendar-check"></i> Upcoming Reviews</h3>
                {% if upcoming_reviews %}
                <div class="review-list">
                    {% for review in upcoming_reviews %}
                    <a href="{% url 'dashboard:relevancereview_detail' review.pk %}" class="review-item-link">
                        <div class="review-item">
                            <div class="review-main">
                                <div class="review-icon">
                                    {% if review.account_review %}
                                        <i class="fas fa-user-circle"></i>
                                    {% elif review.device_review %}
                                        <i class="fas fa-laptop"></i>
                                    {% elif review.estate_review %}
                                        <i class="fas fa-file-contract"></i>
                                    {% elif review.important_document_review %}
                                        <i class="fas fa-file-alt"></i>
                                    {% endif %}
                                </div>
                                <div class="review-info">
                                    <div class="review-name">{{ review.get_item_name|truncatewords:6 }}</div>
                                    <div class="review-meta">
                                        <span class="review-type">{{ review.get_item_type }}</span>
                                        <span class="review-separator">â€¢</span>
                                        <span class="review-date">{{ review.next_review_due|date:"M j, Y" }}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="review-status">
                                {% if review.next_review_due <= today %}
                                    <span class="status-badge overdue">
                                        <i class="fas fa-exclamation-circle"></i> Overdue
                                    </span>
                                {% elif review.next_review_due <= week_from_now %}
                                    <span class="status-badge warning">
                                        <i class="fas fa-clock"></i> Due Soon
                                    </span>
                                {% else %}
                                    <span class="status-badge upcoming">
                                        <i class="fas fa-calendar"></i> {{ review.next_review_due|timeuntil|truncatewords:2 }}
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                    </a>
                    {% endfor %}
                </div>
                <div class="review-footer">
                    <a href="{% url 'dashboard:relevancereview_list' %}" class="view-all-reviews">
                        View All Reviews <i class="fas fa-chevron-right"></i>
                    </a>
                </div>
                {% else %}
                <div class="empty-reviews">
                    <div class="empty-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <p class="empty-message">No upcoming reviews</p>
                    <p class="empty-hint">Reviews will appear here as items are added</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    {% include "baseapp/footer.html" %}

    <script src="https://kit.fontawesome.com/ea6a27c21b.js" crossorigin="anonymous"></script>
    <script src="{% static 'dashboard/js/progress.js' %}"></script>
        <script src="{% static 'dashboard/js/test.js' %}"></script>
</body>

</html>