{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Your Digital Vault - Digital Estate Planning</title>
    <link rel="stylesheet" href="{% static 'baseapp/css/stylesheet.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'baseapp/css/index.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'dashboard/css/stylesheet.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'dashboard/css/test.css' %}" type="text/css">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>

<body>
    {% include "baseapp/navbar.html" %}
    {% include "dashboard/navblocks.html" %}
    
    <div class="vault-dashboard">
        <!-- Hero Section -->
        <div class="vault-hero">
            <h1>
                {% if profile.full_name %}
                    {{ profile.full_name }}'s Digital Vault
                {% else %}
                    Your Digital Vault
                {% endif %}
            </h1>
            <p class="subtitle">
                {% if progress >= 100 %}
                    üîí Fully Secured - Your digital legacy is protected
                {% elif progress >= 70 %}
                    üîê Nearly Complete - Just a few more items to secure
                {% elif progress >= 40 %}
                    üîì Building Security - Keep adding to strengthen your vault
                {% else %}
                    üîì Getting Started - Begin securing your digital estate
                {% endif %}
            </p>
        </div>

        <!-- Main Vault Container -->
        <div class="vault-container">
            <!-- Left: The Vault -->
            <div class="vault-visual">
                <div class="vault-title">
                    <h2>Security Vault</h2>
                    <p class="vault-status">
                        {% if progress >= 100 %}
                            All systems secured
                        {% else %}
                            {{ remaining_tasks }} {% if remaining_tasks == 1 %}category{% else %}categories{% endif %} need attention
                        {% endif %}
                    </p>
                </div>

                <!-- The Vault Door -->
                <div class="vault-door">
                    <!-- 4 Corner Locks -->
                    <div class="vault-locks">
                        <div class="vault-lock {% if accounts_count >= 3 %}locked{% endif %}" 
                             data-category="Accounts">
                            <i class="fas {% if accounts_count >= 3 %}fa-lock{% else %}fa-lock-open{% endif %}"></i>
                        </div>
                        <div class="vault-lock {% if devices_count >= 2 %}locked{% endif %}" 
                             data-category="Devices">
                            <i class="fas {% if devices_count >= 2 %}fa-lock{% else %}fa-lock-open{% endif %}"></i>
                        </div>
                        <div class="vault-lock {% if contacts_count >= 3 %}locked{% endif %}" 
                             data-category="Contacts">
                            <i class="fas {% if contacts_count >= 3 %}fa-lock{% else %}fa-lock-open{% endif %}"></i>
                        </div>
                        <div class="vault-lock {% if estates_count >= 2 or documents_count >= 2 %}locked{% endif %}" 
                             data-category="Documents">
                            <i class="fas {% if estates_count >= 2 or documents_count >= 2 %}fa-lock{% else %}fa-lock-open{% endif %}"></i>
                        </div>
                    </div>

                    <!-- Central Progress Display -->
                    <div class="vault-center">
                        <div class="vault-progress-display" id="vault-progress-text">{{ progress }}%</div>
                        <div class="vault-progress-label">Protected</div>
                    </div>
                </div>

                <input type="hidden" id="progress-value" value="{{ progress|default:0 }}">
            </div>

            <!-- Right: Protection Layers -->
            <div class="protection-layers">
                <h3><i class="fas fa-shield-alt"></i> Protection Layers</h3>

                <!-- Core Identity Layer -->
                <div class="layer core">
                    <div class="layer-header">
                        <div class="layer-name">
                            <span class="layer-icon">üë§</span>
                            Core Identity
                        </div>
                        <div class="layer-status">{{ contacts_count }}/5</div>
                    </div>
                    <div class="layer-strength">
                        <div class="layer-strength-fill" style="width: {% if contacts_count %}{% widthratio contacts_count 1 20 %}{% else %}0{% endif %}%"></div>
                    </div>
                    <div class="layer-label">
                        <span>Contacts & Profile</span>
                        <span class="layer-rating {% if contacts_count >= 5 %}excellent{% elif contacts_count >= 3 %}strong{% elif contacts_count >= 1 %}moderate{% else %}weak{% endif %}">
                            {% if contacts_count >= 5 %}EXCELLENT{% elif contacts_count >= 3 %}STRONG{% elif contacts_count >= 1 %}MODERATE{% else %}WEAK{% endif %}
                        </span>
                    </div>
                </div>

                <!-- Digital Accounts Layer -->
                <div class="layer accounts">
                    <div class="layer-header">
                        <div class="layer-name">
                            <span class="layer-icon">üîê</span>
                            Digital Accounts
                        </div>
                        <div class="layer-status">{{ accounts_count }}/10</div>
                    </div>
                    <div class="layer-strength">
                        <div class="layer-strength-fill" style="width: {% if accounts_count %}{% widthratio accounts_count 1 10 %}{% else %}0{% endif %}%"></div>
                    </div>
                    <div class="layer-label">
                        <span>Online Accounts & Credentials</span>
                        <span class="layer-rating {% if accounts_count >= 10 %}excellent{% elif accounts_count >= 5 %}strong{% elif accounts_count >= 2 %}moderate{% else %}weak{% endif %}">
                            {% if accounts_count >= 10 %}EXCELLENT{% elif accounts_count >= 5 %}STRONG{% elif accounts_count >= 2 %}MODERATE{% else %}WEAK{% endif %}
                        </span>
                    </div>
                </div>

                <!-- Physical Assets Layer -->
                <div class="layer assets">
                    <div class="layer-header">
                        <div class="layer-name">
                            <span class="layer-icon">üì±</span>
                            Physical Assets
                        </div>
                        <div class="layer-status">{{ devices_count }}/5</div>
                    </div>
                    <div class="layer-strength">
                        <div class="layer-strength-fill" style="width: {% if devices_count %}{% widthratio devices_count 1 20 %}{% else %}0{% endif %}%"></div>
                    </div>
                    <div class="layer-label">
                        <span>Devices & Hardware</span>
                        <span class="layer-rating {% if devices_count >= 5 %}excellent{% elif devices_count >= 3 %}strong{% elif devices_count >= 1 %}moderate{% else %}weak{% endif %}">
                            {% if devices_count >= 5 %}EXCELLENT{% elif devices_count >= 3 %}STRONG{% elif devices_count >= 1 %}MODERATE{% else %}WEAK{% endif %}
                        </span>
                    </div>
                </div>

                <!-- Legacy Documents Layer -->
                <div class="layer legacy">
                    <div class="layer-header">
                        <div class="layer-name">
                            <span class="layer-icon">üìÑ</span>
                            Legacy Documents
                        </div>
                        <div class="layer-status">{{ estates_count|add:documents_count }}/8</div>
                    </div>
                    <div class="layer-strength">
                        <div class="layer-strength-fill" style="width: {% with total=estates_count|add:documents_count %}{% if total %}{% widthratio total 1 12.5 %}{% else %}0{% endif %}{% endwith %}%"></div>
                    </div>
                    <div class="layer-label">
                        <span>Estate & Important Documents</span>
                        <span class="layer-rating {% if estates_count|add:documents_count >= 8 %}excellent{% elif estates_count|add:documents_count >= 5 %}strong{% elif estates_count|add:documents_count >= 2 %}moderate{% else %}weak{% endif %}">
                            {% if estates_count|add:documents_count >= 8 %}EXCELLENT{% elif estates_count|add:documents_count >= 5 %}STRONG{% elif estates_count|add:documents_count >= 2 %}MODERATE{% else %}WEAK{% endif %}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Security Log & Upcoming Reviews -->
        <div class="vault-container">
            <div class="security-log">
                <h3><i class="fas fa-clipboard-list"></i> Security Log</h3>
                <div class="log-entries">
                    {% if accounts_count > 0 %}
                    <div class="log-entry">
                        <div class="log-icon success">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="log-content">
                            <div class="log-message">{{ accounts_count }} digital {% if accounts_count == 1 %}account{% else %}accounts{% endif %} secured</div>
                            <div class="log-time">Active protection</div>
                        </div>
                    </div>
                    {% endif %}

                    {% if devices_count > 0 %}
                    <div class="log-entry">
                        <div class="log-icon success">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="log-content">
                            <div class="log-message">{{ devices_count }} {% if devices_count == 1 %}device{% else %}devices{% endif %} registered</div>
                            <div class="log-time">Active protection</div>
                        </div>
                    </div>
                    {% endif %}

                    {% if first_delta %}
                    <div class="log-entry">
                        <div class="log-icon {% if first_delta.days <= 7 %}alert{% elif first_delta.days <= 30 %}warning{% else %}success{% endif %}">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="log-content">
                            <div class="log-message">
                                {% if first_delta.days <= 0 %}
                                    Review overdue - action required
                                {% elif first_delta.days <= 7 %}
                                    Review due in {{ first_delta.days }} {% if first_delta.days == 1 %}day{% else %}days{% endif %}
                                {% else %}
                                    Next review in {{ first_delta.days }} days
                                {% endif %}
                            </div>
                            <div class="log-time">Scheduled maintenance</div>
                        </div>
                    </div>
                    {% endif %}

                    {% if remaining_tasks > 0 %}
                    <div class="log-entry">
                        <div class="log-icon warning">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="log-content">
                            <div class="log-message">
                                {% if remaining_tasks >= 1 and accounts_count == 0 %}
                                    Accounts Need Attention
                                {% elif remaining_tasks >= 1 and care_relations_count == 0 %}    
                                    Care Relation Needs Attention                            
                                {% elif remaining_tasks >= 1 and contacts_count == 0 %}
                                    Contacts Need Attention
                                {% elif remaining_tasks >= 1 and devices_count == 0 %}
                                    Devices Needs Attention
                                {% elif remaining_tasks >= 1 and documents_count == 0 %}
                                    Important Documents Need Attention
                                {% elif remaining_tasks >= 1 and estates_count == 0 %}
                                    Estate Documents Need Attention
                                {% elif remaining_tasks >= 1 and family_knows_count == 0 %}
                                    Family Needs to Know Needs Attention 
                                {% endif %}
                                
                            <div class="log-time">Security recommendation</div>
                        </div>
                    </div>
                    {% endif %}

                    {% if progress >= 100 %}
                    <div class="log-entry">
                        <div class="log-icon success">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="log-content">
                            <div class="log-message">Vault fully secured - all systems operational</div>
                            <div class="log-time">Congratulations!</div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Upcoming Reviews Section -->
        </div>
        <div class="upcoming-reviews">
            <h3><i class="fas fa-calendar-check"></i> Upcoming Reviews</h3>
            {% if upcoming_reviews %}
            <div class="review-list">
                {% for review in upcoming_reviews %}
                <div class="review-item">
                    <div class="review-icon">
                        {% if review.account_review %}
                            <i class="fas fa-user-lock"></i>
                        {% elif review.device_review %}
                            <i class="fas fa-laptop"></i>
                        {% elif review.estate_review %}
                            <i class="fas fa-file-contract"></i>
                        {% elif review.important_document_review %}
                            <i class="fas fa-file-alt"></i>
                        {% endif %}
                    </div>
                    <div class="review-content">
                        <div class="review-name">{{ review.get_item_name|truncatewords:5 }}</div>
                        <div class="review-type">{{ review.get_item_type }}</div>
                    </div>
                    <div class="review-due">
                        {% if review.next_review_due <= today %}
                            <span class="due-badge overdue">Overdue</span>
                        {% elif review.next_review_due <= week_from_now %}
                            <span class="due-badge warning">{{ review.next_review_due|timeuntil|truncatewords:2 }}</span>
                        {% else %}
                            <span class="due-badge upcoming">{{ review.next_review_due|timeuntil|truncatewords:2 }}</span>
                        {% endif %}
                    </div>
                    <a href="{% url 'dashboard:relevancereview_detail' review.pk %}" class="review-link">
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                {% endfor %}
            </div>
            <div class="review-footer">
                <a href="{% url 'dashboard:relevancereview_list' %}" class="view-all-link">
                    View All Reviews <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            {% else %}
            <div class="empty-state">
                <i class="fas fa-calendar-check"></i>
                <p>No upcoming reviews scheduled</p>
                <small>Reviews will appear here as you add items</small>
            </div>
            {% endif %}
        </div>
    </div>

    {% include "baseapp/footer.html" %}

    <script src="https://kit.fontawesome.com/ea6a27c21b.js" crossorigin="anonymous"></script>
    <script src="{% static 'dashboard/js/test.js' %}"></script>
</body>

</html>